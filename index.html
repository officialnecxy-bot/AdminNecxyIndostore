<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NECXY PRO | ELITE ADMIN CONSOLE</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { 
                        primary: '#FF003C', 
                        dark: '#050505', 
                        card: '#0F0F0F',
                        accent: '#22C55E',
                        indo: '#833ab4',
                        method: '#ff5e62',
                        cc: '#11998e',
                        bin: '#2193b0',
                        paynow: '#654ea3'
                    },
                    fontFamily: { sans: ['Outfit', 'sans-serif'] },
                    animation: {
                        'slide-in': 'slideIn 0.3s ease-out',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'pulse-slow': 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        slideIn: {
                            '0%': { transform: 'translateX(100%)', opacity: '0' },
                            '100%': { transform: 'translateX(0)', opacity: '1' }
                        },
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' }
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #000; color: #e5e5e5; font-family: 'Outfit', sans-serif; overflow: hidden; height: 100vh; }
        .sidebar-glass { background: #050505; border-right: 1px solid rgba(255,255,255,0.05); transition: 0.4s; }
        .content-glass { background: rgba(15, 15, 15, 0.7); backdrop-filter: blur(30px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .nav-item { display: flex; align-items: center; gap: 14px; padding: 16px 24px; color: #777; border-radius: 16px; transition: 0.4s; margin-bottom: 8px; font-weight: 600; font-size: 0.85rem; cursor: pointer; }
        .nav-item:hover { color: #fff; background: rgba(255,255,255,0.03); }
        .nav-item.active { background: linear-gradient(90deg, rgba(255,0,60,0.12), transparent); color: #FF003C; border-left: 4px solid #FF003C; }
        .input-dark { background: #000; border: 1px solid #1a1a1a; color: white; padding: 12px 16px; border-radius: 16px; width: 100%; outline: none; transition: 0.3s; font-size: 0.8rem; }
        .input-dark:focus { border-color: #FF003C; box-shadow: 0 0 20px rgba(255,0,60,0.1); }
        
        .switch { position: relative; display: inline-block; width: 48px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #222; transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #FF003C; }
        input:checked + .slider:before { transform: translateX(24px); }

        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: #000; }
        ::-webkit-scrollbar-thumb { background: #222; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #FF003C; }

        .neo-card { transition: 0.4s; border: 1px solid rgba(255,255,255,0.05); position: relative; overflow: hidden; }
        .neo-card:hover { transform: translateY(-3px); border-color: rgba(255,0,60,0.2); background: rgba(255,255,255,0.02); }

        @media (max-width: 768px) {
            .sidebar-mobile-hidden { transform: translateX(-100%); position: fixed; height: 100vh; z-index: 1000; }
            .sidebar-mobile-show { transform: translateX(0); position: fixed; height: 100vh; z-index: 1000; }
        }
        
        /* PRODUCT CARD STYLES - Same as User Panel */
        .product-card { 
            background: linear-gradient(160deg, rgba(18, 18, 18, 0.9) 0%, rgba(8, 8, 8, 0.9) 100%); 
            border: 1px solid rgba(255, 255, 255, 0.08); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
            position: relative; 
            overflow: hidden; 
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            border-radius: 20px;
        }
        
        .product-card:hover { 
            transform: translateY(-5px) scale(1.02); 
            border-color: rgba(255, 0, 60, 0.3); 
            box-shadow: 0 15px 40px rgba(255, 0, 60, 0.2);
        }
        
        .insta-icon { background: -webkit-linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: inline-block; }
        
        /* Compact Inventory Navbar */
        .inventory-nav {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            padding: 12px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            overflow-x: auto;
        }
        
        .inventory-nav-btn {
            padding: 10px 16px;
            border-radius: 14px;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 1px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 1px solid transparent;
        }
        
        .inventory-nav-btn:hover {
            transform: translateY(-1px);
        }
        
        .inventory-nav-btn.active {
            border-color: currentColor;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .inventory-nav-btn i {
            font-size: 12px;
        }
        
        /* Category specific buttons */
        .nav-btn-all { background: rgba(255, 255, 255, 0.05); color: white; }
        .nav-btn-indo { background: rgba(131, 58, 180, 0.1); color: #833ab4; }
        .nav-btn-cc { background: rgba(17, 153, 142, 0.1); color: #11998e; }
        .nav-btn-method { background: rgba(255, 94, 98, 0.1); color: #ff5e62; }
        .nav-btn-bin { background: rgba(33, 147, 176, 0.1); color: #2193b0; }
        .nav-btn-paynow { background: rgba(101, 78, 163, 0.1); color: #654ea3; }
        
        /* Enhanced Login Styles */
        .login-container {
            background: linear-gradient(135deg, #000000 0%, #0a0a0a 50%, #111111 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            width: 100%;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
        }
        
        .login-card {
            background: rgba(10, 10, 10, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 32px;
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 440px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(20px);
        }
        
        .login-header {
            position: relative;
            z-index: 1;
            text-align: center;
            padding: 40px 40px 20px;
        }
        
        .login-body {
            position: relative;
            z-index: 1;
            padding: 0 40px;
        }
        
        .login-footer {
            position: relative;
            z-index: 1;
            padding: 30px 40px 40px;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .auth-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 4px;
            margin-bottom: 30px;
        }
        
        .auth-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 1px;
            color: #666;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .auth-tab.active {
            background: linear-gradient(135deg, #FF003C 0%, #CC002F 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 0, 60, 0.3);
        }
        
        .input-group {
            margin-bottom: 16px;
        }
        
        .input-group label {
            display: block;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #888;
            margin-bottom: 6px;
            padding-left: 10px;
        }
        
        .input-wrapper {
            display: flex;
            align-items: center;
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 16px;
            padding: 0 14px;
            transition: all 0.3s;
        }
        
        .input-wrapper:focus-within {
            border-color: #FF003C;
            box-shadow: 0 0 0 3px rgba(255, 0, 60, 0.1);
        }
        
        .input-wrapper i {
            color: #666;
            font-size: 13px;
            margin-right: 10px;
            min-width: 14px;
        }
        
        .input-wrapper input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            padding: 16px 0;
            font-size: 13px;
            font-weight: 500;
            outline: none;
            width: 100%;
        }
        
        .btn-primary {
            width: 100%;
            background: linear-gradient(135deg, #FF003C 0%, #CC002F 100%);
            color: white;
            border: none;
            padding: 18px;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 800;
            letter-spacing: 2px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 8px;
            position: relative;
            overflow: hidden;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(255, 0, 60, 0.3);
        }
        
        .btn-primary:active {
            transform: translateY(0);
        }
        
        .btn-green {
            background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%) !important;
        }
        
        .btn-green:hover {
            box-shadow: 0 10px 20px rgba(34, 197, 94, 0.3) !important;
        }
        
        .loader {
            width: 16px;
            height: 16px;
            border: 2px solid #FFF;
            border-bottom-color: transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            display: inline-block;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Enhanced Member Popup */
        .member-popup-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }
        
        .member-info-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 14px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .member-info-label {
            font-size: 8px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 800;
            margin-bottom: 4px;
        }
        
        .member-info-value {
            font-size: 13px;
            font-weight: 700;
            color: white;
        }
        
        .member-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 8px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .badge-active { background: rgba(34, 197, 94, 0.1); color: #22C55E; border: 1px solid rgba(34, 197, 94, 0.2); }
        .badge-banned { background: rgba(239, 68, 68, 0.1); color: #EF4444; border: 1px solid rgba(239, 68, 68, 0.2); }
        .badge-premium { background: rgba(255, 0, 60, 0.1); color: #FF003C; border: 1px solid rgba(255, 0, 60, 0.2); }
        .badge-admin { background: rgba(59, 130, 246, 0.1); color: #3B82F6; border: 1px solid rgba(59, 130, 246, 0.2); }
        
        /* Product Category Boxes */
        .category-boxes {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
            margin-bottom: 15px;
            padding: 8px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .category-box {
            flex: 1;
            min-width: 100px;
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 14px;
            padding: 12px 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .category-box:hover {
            background: rgba(255, 255, 255, 0.05);
            transform: translateY(-2px);
        }
        
        .category-box.active {
            background: rgba(255, 0, 60, 0.1);
            border-color: #FF003C;
            box-shadow: 0 5px 15px rgba(255, 0, 60, 0.2);
        }
        
        .category-box i {
            font-size: 20px;
            margin-bottom: 8px;
            display: block;
            transition: all 0.3s;
        }
        
        .category-box span {
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: block;
        }
        
        /* Custom Icons for Categories */
        .category-box[data-type="indo"] i { color: #833ab4; }
        .category-box[data-type="cc"] i { color: #11998e; }
        .category-box[data-type="method"] i { color: #ff5e62; }
        .category-box[data-type="bin"] i { color: #2193b0; }
        .category-box[data-type="paynow"] i { color: #654ea3; }
        
        .category-box.active[data-type="indo"] i { color: #ff6b9d; }
        .category-box.active[data-type="cc"] i { color: #4ade80; }
        .category-box.active[data-type="method"] i { color: #ff9966; }
        .category-box.active[data-type="bin"] i { color: #6dd5ed; }
        .category-box.active[data-type="paynow"] i { color: #eaafc8; }
        
        /* Deposit Delete Button */
        .delete-deposit-btn {
            background: rgba(239, 68, 68, 0.1);
            color: #EF4444;
            border: 1px solid rgba(239, 68, 68, 0.2);
            padding: 6px 12px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .delete-deposit-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            transform: translateY(-1px);
        }
        
        /* Admin Registration Secret */
        .admin-secret-note {
            font-size: 8px;
            color: #666;
            text-align: center;
            margin-top: 12px;
            font-style: italic;
        }
        
        /* Custom Alert */
        .custom-alert {
            position: fixed;
            inset: 0;
            z-index: 9000;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .alert-content {
            background: linear-gradient(135deg, #0a0a0a 0%, #050505 100%);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 30px;
            padding: 35px;
            max-width: 380px;
            width: 100%;
            text-align: center;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
        }
        
        .alert-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
            font-size: 24px;
        }
        
        .alert-danger { background: rgba(239, 68, 68, 0.1); color: #EF4444; border: 1px solid rgba(239, 68, 68, 0.2); }
        .alert-warning { background: rgba(234, 179, 8, 0.1); color: #EAB308; border: 1px solid rgba(234, 179, 8, 0.2); }
        .alert-success { background: rgba(34, 197, 94, 0.1); color: #22C55E; border: 1px solid rgba(34, 197, 94, 0.2); }
        .alert-primary { background: rgba(255, 0, 60, 0.1); color: #FF003C; border: 1px solid rgba(255, 0, 60, 0.2); }
        
        /* Toast Styling */
        .toast-success { border-left: 4px solid #22C55E; }
        .toast-error { border-left: 4px solid #EF4444; }
        .toast-warning { border-left: 4px solid #EAB308; }
        .toast-info { border-left: 4px solid #3B82F6; }
        
        /* Gallery Grid */
        .gallery-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .gallery-item {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            aspect-ratio: 9/16;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.08);
            background: linear-gradient(135deg, rgba(15, 15, 15, 0.9) 0%, rgba(10, 10, 10, 0.9) 100%);
        }
        
        .gallery-item:hover {
            transform: translateY(-5px) scale(1.03);
            border-color: rgba(255, 0, 60, 0.3);
            box-shadow: 0 10px 30px rgba(255, 0, 60, 0.2);
        }
        
        .gallery-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .gallery-item:hover .gallery-image {
            transform: scale(1.05);
        }
        
        .gallery-overlay {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
            padding: 15px;
            transform: translateY(10px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .gallery-item:hover .gallery-overlay {
            transform: translateY(0);
            opacity: 1;
        }
        
        .gallery-description {
            font-size: 11px;
            color: #ddd;
            line-height: 1.4;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }
        
        .gallery-item:hover .gallery-description {
            max-height: 100px;
            margin-top: 8px;
        }
        
        /* Enhanced User Popup */
        .user-popup-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
            margin-top: 15px;
        }
        
        .user-action-btn {
            padding: 12px;
            border-radius: 12px;
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .user-action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .action-danger { background: rgba(239, 68, 68, 0.1); color: #EF4444; border-color: rgba(239, 68, 68, 0.2); }
        .action-success { background: rgba(34, 197, 94, 0.1); color: #22C55E; border-color: rgba(34, 197, 94, 0.2); }
        .action-warning { background: rgba(234, 179, 8, 0.1); color: #EAB308; border-color: rgba(234, 179, 8, 0.2); }
        .action-primary { background: rgba(255, 0, 60, 0.1); color: #FF003C; border-color: rgba(255, 0, 60, 0.2); }
        .action-info { background: rgba(59, 130, 246, 0.1); color: #3B82F6; border-color: rgba(59, 130, 246, 0.2); }
        
        /* Order Details Modal */
        .order-details-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 15px 0;
        }
        
        .order-detail-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .order-detail-label {
            font-size: 8px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 800;
            margin-bottom: 4px;
        }
        
        .order-detail-value {
            font-size: 12px;
            font-weight: 700;
            color: white;
            word-break: break-all;
        }
        
        .data-view-box {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 12px;
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }
        
        .data-text {
            font-family: monospace;
            font-size: 11px;
            color: #ddd;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        /* Product Icons Styling */
        .icon-indo { background: -webkit-linear-gradient(45deg, #f09433 0%, #e6683c 25%, #dc2743 50%, #cc2366 75%, #bc1888 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .icon-cc { color: #11998e; }
        .icon-method { color: #ff5e62; }
        .icon-bin { color: #2193b0; }
        .icon-paynow { color: #654ea3; }
        
        /* Broadcast Notification Styles */
        .broadcast-form-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .broadcast-preview {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            margin-top: 20px;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
        }
        
        .notification-card {
            background: linear-gradient(135deg, rgba(15, 15, 15, 0.9) 0%, rgba(10, 10, 10, 0.9) 100%);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        
        .notification-card:hover {
            border-color: rgba(255, 0, 60, 0.3);
            box-shadow: 0 10px 30px rgba(255, 0, 60, 0.2);
        }
        
        .notification-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 12px;
            margin: 15px 0;
            object-fit: contain;
        }
        
        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .notification-type-badge {
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 8px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .badge-text-only { background: rgba(59, 130, 246, 0.1); color: #3B82F6; border: 1px solid rgba(59, 130, 246, 0.2); }
        .badge-with-image { background: rgba(255, 0, 60, 0.1); color: #FF003C; border: 1px solid rgba(255, 0, 60, 0.2); }
        
        .notification-sent-badge {
            background: rgba(34, 197, 94, 0.1);
            color: #22C55E;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 8px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: 1px solid rgba(34, 197, 94, 0.2);
        }
        
        .notification-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
        }
        
        .notification-action-btn {
            padding: 8px 12px;
            border-radius: 10px;
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid transparent;
        }
        
        .notification-action-btn:hover {
            transform: translateY(-2px);
        }
        
        .action-send { background: linear-gradient(135deg, #22C55E 0%, #16A34A 100%); color: white; }
        .action-delete { background: rgba(239, 68, 68, 0.1); color: #EF4444; border: 1px solid rgba(239, 68, 68, 0.2); }
        .action-preview { background: rgba(59, 130, 246, 0.1); color: #3B82F6; border: 1px solid rgba(59, 130, 246, 0.2); }
        
        .image-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .image-upload-area:hover {
            border-color: #FF003C;
            background: rgba(255, 0, 60, 0.05);
        }
        
        .image-upload-area.dragover {
            border-color: #22C55E;
            background: rgba(34, 197, 94, 0.05);
        }
        
        .image-preview-container {
            position: relative;
            margin-top: 15px;
        }
        
        .remove-image-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 30px;
            height: 30px;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .remove-image-btn:hover {
            background: #FF003C;
            transform: scale(1.1);
        }
        
        .char-counter {
            font-size: 10px;
            text-align: right;
            color: #666;
            margin-top: 5px;
        }
        
        .char-counter.warning {
            color: #EAB308;
        }
        
        .char-counter.error {
            color: #EF4444;
        }
        
        .notification-tabs {
            display: flex;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 4px;
            margin-bottom: 20px;
        }
        
        .notification-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            font-size: 10px;
            font-weight: 800;
            letter-spacing: 1px;
            color: #666;
            border-radius: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .notification-tab.active {
            background: linear-gradient(135deg, #FF003C 0%, #CC002F 100%);
            color: white;
            box-shadow: 0 5px 15px rgba(255, 0, 60, 0.3);
        }
    </style>
</head>
<body class="flex h-screen overflow-hidden">

    <!-- Toast Area -->
    <div id="toast-area" class="fixed top-5 right-5 z-[8000] flex flex-col gap-2 max-w-sm"></div>

    <!-- Custom Alert -->
    <div id="custom-alert" class="custom-alert">
        <div class="alert-content">
            <div id="alert-icon" class="alert-icon alert-primary">
                <i class="fa-solid fa-shield-halved"></i>
            </div>
            <h3 id="alert-title" class="text-xl font-black uppercase text-white tracking-tighter mb-2">Confirm Action</h3>
            <p id="alert-msg" class="text-[10px] text-gray-500 font-bold uppercase tracking-[0.1em] mb-6">Proceed with this administrative action?</p>
            <div class="flex gap-3">
                <button onclick="closeAlert()" class="flex-1 py-3 bg-white/5 rounded-xl font-black uppercase text-[9px] tracking-widest hover:bg-white/10 transition border border-white/5">Cancel</button>
                <button id="alert-confirm-btn" class="flex-1 py-3 bg-primary rounded-xl font-black uppercase text-[9px] tracking-widest text-white shadow-xl shadow-red-500/20 hover:scale-105 transition">Verify</button>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <aside id="main-sidebar" class="w-72 sidebar-glass sidebar-mobile-hidden md:translate-x-0 flex flex-col h-full z-[1001]">
        <div class="h-28 flex items-center justify-between px-10 border-b border-white/5">
            <h1 class="text-2xl font-black text-white italic tracking-tighter">NECXY <span class="text-primary">PRO</span></h1>
            <button onclick="toggleSidebar()" class="md:hidden text-gray-500"><i class="fa-solid fa-xmark"></i></button>
        </div>
        <nav class="flex-1 py-10 px-6 overflow-y-auto">
            <div onclick="switchTab('dash')" id="nav-dash" class="nav-item active"><i class="fa-solid fa-layer-group"></i> Console</div>
            <div onclick="switchTab('orders')" id="nav-orders" class="nav-item"><i class="fa-solid fa-receipt"></i> Sales History</div>
            <div onclick="switchTab('products')" id="nav-products" class="nav-item"><i class="fa-solid fa-cubes"></i> Inventory</div>
            <div onclick="switchTab('users')" id="nav-users" class="nav-item"><i class="fa-solid fa-users-viewfinder"></i> Member CRM</div>
            <div onclick="switchTab('deposits')" id="nav-deposits" class="nav-item"><i class="fa-solid fa-money-bill-transfer"></i> Fund Requests</div>
            <div onclick="switchTab('gallery')" id="nav-gallery" class="nav-item"><i class="fa-solid fa-images"></i> Gallery</div>
            <div onclick="switchTab('requests')" id="nav-requests" class="nav-item"><i class="fa-solid fa-comment-dots"></i> User Requests</div>
            <!-- NEW BROADCAST TAB -->
            <div onclick="switchTab('broadcast')" id="nav-broadcast" class="nav-item"><i class="fa-solid fa-bullhorn"></i> Broadcast</div>
            <div onclick="switchTab('settings')" id="nav-settings" class="nav-item"><i class="fa-solid fa-server"></i> System Config</div>
        </nav>
        <div class="p-8 border-t border-white/5">
            <button onclick="confirmAction('Securely logout from the system?', logoutAdmin)" class="w-full py-3 rounded-xl bg-white/5 text-gray-400 hover:text-red-500 transition font-black text-[9px] uppercase tracking-widest">Sign Out</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 h-full overflow-y-auto bg-[#020202] p-4 md:p-10 relative">
        <header class="md:hidden flex items-center justify-between mb-8">
            <button onclick="toggleSidebar()" class="text-white bg-card p-4 rounded-xl border border-white/10"><i class="fa-solid fa-bars-staggered"></i></button>
            <h1 class="text-lg font-black text-white italic">NECXY <span class="text-primary">PRO</span></h1>
        </header>

        <!-- Dashboard -->
        <section id="page-dash" class="space-y-10 animate-fade-in">
            <div class="flex justify-between items-end">
                <div>
                    <span class="text-primary font-black text-[9px] uppercase tracking-[0.4em] mb-2 block">Database Status: Active</span>
                    <h2 class="text-4xl font-black uppercase text-white tracking-tighter">Admin <span class="text-primary">Panel</span></h2>
                </div>
                <div class="text-right hidden md:block">
                    <p id="live-date" class="text-white font-black text-lg uppercase tracking-tighter">--/--/----</p>
                    <p id="live-clock" class="text-primary font-bold text-[9px] tracking-[0.4em] uppercase mt-1">00:00:00 AM</p>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="content-glass p-8 rounded-[35px] neo-card">
                    <p class="text-[9px] text-gray-500 uppercase font-black tracking-[0.2em] mb-3">Total Population</p>
                    <h3 id="stat-users" class="text-5xl font-black text-white">0</h3>
                </div>
                <div class="content-glass p-8 rounded-[35px] neo-card border-b-4 border-green-500/30">
                    <p class="text-[9px] text-gray-500 uppercase font-black tracking-[0.2em] mb-3">Global Capital</p>
                    <h3 id="stat-balance" class="text-5xl font-black text-white">₹0</h3>
                </div>
                <div class="content-glass p-8 rounded-[35px] neo-card border-b-4 border-primary/30">
                    <p class="text-[9px] text-gray-500 uppercase font-black tracking-[0.2em] mb-3">Action Required</p>
                    <h3 id="stat-requests" class="text-5xl font-black text-primary">0</h3>
                </div>
            </div>
        </section>

        <!-- Orders -->
        <section id="page-orders" class="hidden space-y-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <h2 class="text-3xl font-black uppercase text-white tracking-tighter">Trade <span class="text-primary">Records</span></h2>
                <button onclick="confirmAction('Execute global wipe of all sales data?', clearSalesHistory)" class="bg-red-600/10 text-red-500 border border-red-600/20 px-6 py-3 rounded-xl font-black text-[9px] uppercase tracking-widest hover:bg-red-600 hover:text-white transition">Wipe Sales Log</button>
            </div>
            
            <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" id="search-orders" onkeyup="renderOrders()" placeholder="Search Name, UID, or Product..." class="input-dark pl-12">
            </div>

            <div id="orders-list" class="grid grid-cols-1 gap-4 pb-16"></div>
        </section>

        <!-- Products -->
        <section id="page-products" class="hidden space-y-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <div>
                    <h2 class="text-3xl font-black uppercase text-white tracking-tighter">Vault <span class="text-primary">Assets</span></h2>
                    <p class="text-[9px] text-gray-500 uppercase font-black tracking-[0.2em] mt-1">Dynamic Inventory Management</p>
                </div>
                <button onclick="openProductModal()" class="bg-primary text-white px-8 py-4 rounded-[18px] font-black text-[10px] uppercase tracking-widest shadow-2xl shadow-red-500/30 hover:scale-105 transition">
                    <i class="fa-solid fa-plus mr-2"></i> New Asset
                </button>
            </div>

            <!-- Inventory Navbar -->
            <div class="inventory-nav">
                <button onclick="filterProducts('all')" class="inventory-nav-btn nav-btn-all active">
                    <i class="fa-solid fa-grid-2"></i> All Assets
                </button>
                <button onclick="filterProducts('indo')" class="inventory-nav-btn nav-btn-indo">
                    <i class="fa-brands fa-instagram"></i> Indo
                </button>
                <button onclick="filterProducts('cc')" class="inventory-nav-btn nav-btn-cc">
                    <i class="fa-solid fa-credit-card"></i> CC's
                </button>
                <button onclick="filterProducts('method')" class="inventory-nav-btn nav-btn-method">
                    <i class="fa-solid fa-fire"></i> Method
                </button>
                <button onclick="filterProducts('bin')" class="inventory-nav-btn nav-btn-bin">
                    <i class="fa-solid fa-microchip"></i> Bin
                </button>
                <button onclick="filterProducts('paynow')" class="inventory-nav-btn nav-btn-paynow">
                    <i class="fa-solid fa-bolt"></i> Pay Now
                </button>
            </div>

            <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" id="search-products" onkeyup="renderProducts()" placeholder="Search assets by name, category, or description..." class="input-dark pl-12">
            </div>
            
            <!-- PRODUCT GRID - Same as User Panel -->
            <div id="products-list" class="grid grid-cols-1 gap-4 pb-20"></div>
        </section>

        <!-- Users -->
        <section id="page-users" class="hidden space-y-6">
            <h2 class="text-3xl font-black uppercase text-white tracking-tighter">Member <span class="text-primary">Atlas</span></h2>
            <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" id="search-user" onkeyup="renderUsers()" placeholder="Search User via Name, Email or 6-digit UID..." class="input-dark pl-12">
            </div>
            <div id="users-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-5"></div>
        </section>

        <!-- Deposits -->
        <section id="page-deposits" class="hidden space-y-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <h2 class="text-3xl font-black uppercase text-white tracking-tighter">Revenue <span class="text-primary">Pipeline</span></h2>
                <button onclick="renderDeposits('pending')" class="bg-primary text-white px-5 py-2.5 rounded-[15px] text-[9px] font-black uppercase tracking-widest">Pending Only</button>
            </div>
            
            <div class="grid grid-cols-3 gap-2 mb-6">
                <button onclick="renderDeposits('pending')" id="filter-pending" class="py-2.5 bg-primary text-white rounded-[12px] font-black text-[8px] uppercase tracking-widest">Pending</button>
                <button onclick="renderDeposits('approved')" id="filter-approved" class="py-2.5 bg-white/5 text-gray-400 rounded-[12px] font-black text-[8px] uppercase tracking-widest hover:text-green-500">Approved</button>
                <button onclick="renderDeposits('rejected')" id="filter-rejected" class="py-2.5 bg-white/5 text-gray-400 rounded-[12px] font-black text-[8px] uppercase tracking-widest hover:text-red-500">Rejected</button>
            </div>

            <div id="deposit-list" class="space-y-4"></div>
        </section>

        <!-- Gallery -->
        <section id="page-gallery" class="hidden space-y-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <h2 class="text-3xl font-black uppercase text-white tracking-tighter">Premium <span class="text-primary">Gallery</span></h2>
                <button onclick="openGalleryModal()" class="bg-primary text-white px-8 py-4 rounded-[18px] font-black text-[10px] uppercase tracking-widest shadow-2xl shadow-red-500/30 hover:scale-105 transition">
                    <i class="fa-solid fa-plus mr-2"></i> Add Image
                </button>
            </div>
            
            <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" id="search-gallery" onkeyup="renderGallery()" placeholder="Search gallery by title or description..." class="input-dark pl-12">
            </div>

            <div id="gallery-list" class="gallery-grid pb-16"></div>
        </section>

        <!-- Requests -->
        <section id="page-requests" class="hidden space-y-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <h2 class="text-3xl font-black uppercase text-white tracking-tighter">User <span class="text-primary">Requests</span></h2>
                <button onclick="confirmAction('Clear all user requests?', clearAllRequests)" class="bg-red-600/10 text-red-500 border border-red-600/20 px-6 py-3 rounded-xl font-black text-[9px] uppercase tracking-widest hover:bg-red-600 hover:text-white transition">Clear All</button>
            </div>
            
            <div class="relative">
                <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-gray-500"></i>
                <input type="text" id="search-requests" onkeyup="renderRequests()" placeholder="Search requests..." class="input-dark pl-12">
            </div>

            <div id="requests-list" class="space-y-4 pb-16"></div>
        </section>

        <!-- NEW BROADCAST SECTION -->
        <section id="page-broadcast" class="hidden space-y-6">
            <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
                <h2 class="text-3xl font-black uppercase text-white tracking-tighter">Broadcast <span class="text-primary">Center</span></h2>
                <button onclick="switchBroadcastTab('send')" class="bg-primary text-white px-8 py-4 rounded-[18px] font-black text-[10px] uppercase tracking-widest shadow-2xl shadow-red-500/30 hover:scale-105 transition">
                    <i class="fa-solid fa-bullhorn mr-2"></i> New Notification
                </button>
            </div>
            
            <!-- Broadcast Tabs -->
            <div class="notification-tabs">
                <div onclick="switchBroadcastTab('send')" class="notification-tab active">
                    <i class="fa-solid fa-paper-plane mr-2"></i> Send Notification
                </div>
                <div onclick="switchBroadcastTab('history')" class="notification-tab">
                    <i class="fa-solid fa-clock-rotate-left mr-2"></i> Notification History
                </div>
            </div>

            <!-- Send Notification Form -->
            <div id="broadcast-send" class="broadcast-form-container animate-fade-in">
                <div class="content-glass p-8 rounded-[35px] space-y-6">
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Notification Subject</label>
                        <input id="broadcast-subject" type="text" class="input-dark" placeholder="Enter notification subject (e.g., New Update, Maintenance, Offer)">
                    </div>
                    
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Notification Message</label>
                        <textarea id="broadcast-message" class="input-dark h-32" placeholder="Enter your message to all users... (Max 500 characters)" maxlength="500" oninput="updateCharCount()"></textarea>
                        <div id="char-count" class="char-counter">0/500</div>
                    </div>
                    
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Image URL (Optional)</label>
                        <input id="broadcast-image" type="text" class="input-dark" placeholder="https://example.com/image.jpg">
                        <p class="text-[8px] text-gray-500 mt-1">You can upload an image or paste a direct URL. Supported: JPG, PNG, GIF, WebP</p>
                    </div>
                    
                    <!-- Image Upload Area -->
                    <div id="image-upload-area" class="image-upload-area" onclick="document.getElementById('image-upload-input').click()" ondragover="handleDragOver(event)" ondrop="handleDrop(event)">
                        <i class="fa-solid fa-cloud-arrow-up text-4xl text-gray-500 mb-3"></i>
                        <p class="text-sm font-bold text-gray-400">Drag & Drop Image Here</p>
                        <p class="text-[10px] text-gray-600 mt-1">or click to browse</p>
                        <input type="file" id="image-upload-input" accept="image/*" class="hidden" onchange="handleImageUpload(event)">
                    </div>
                    
                    <!-- Image Preview -->
                    <div id="image-preview-container" class="image-preview-container hidden">
                        <div class="relative">
                            <img id="broadcast-image-preview" src="" alt="Preview" class="notification-image">
                            <div class="remove-image-btn" onclick="removeUploadedImage()">
                                <i class="fa-solid fa-xmark"></i>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Live Preview -->
                    <div class="broadcast-preview" id="notification-preview">
                        <div class="notification-card">
                            <div class="notification-header">
                                <span class="notification-type-badge badge-text-only">Text Only</span>
                                <span class="notification-sent-badge">Preview</span>
                            </div>
                            <h3 id="preview-subject" class="text-lg font-black text-white mb-2">Your Subject Will Appear Here</h3>
                            <p id="preview-message" class="text-sm text-gray-300">Your message will appear here. Users will see this in their notifications panel.</p>
                            <div id="preview-image-container" class="hidden">
                                <img id="preview-image" src="" alt="Preview" class="notification-image">
                            </div>
                            <p class="text-[8px] text-gray-500 mt-3">Sent just now • Admin</p>
                        </div>
                    </div>
                    
                    <div class="flex gap-3 pt-3">
                        <button onclick="updatePreview()" class="flex-1 py-4 bg-blue-500/10 text-blue-500 rounded-[20px] font-bold uppercase text-[9px] tracking-widest border border-blue-500/20 hover:bg-blue-500/20 transition">
                            <i class="fa-solid fa-eye mr-2"></i> Update Preview
                        </button>
                        <button onclick="sendBroadcastNotification()" class="flex-1 py-4 bg-primary rounded-[20px] font-black uppercase text-[9px] tracking-widest shadow-2xl shadow-red-500/30 hover:scale-105 transition">
                            <i class="fa-solid fa-paper-plane mr-2"></i> Send to All Users
                        </button>
                    </div>
                </div>
            </div>

            <!-- Notification History -->
            <div id="broadcast-history" class="hidden">
                <div class="relative mb-6">
                    <i class="fa-solid fa-magnifying-glass absolute left-5 top-1/2 -translate-y-1/2 text-gray-500"></i>
                    <input type="text" id="search-notifications" onkeyup="renderNotifications()" placeholder="Search notifications..." class="input-dark pl-12">
                </div>
                
                <div id="notifications-list" class="space-y-4 pb-16">
                    <!-- Notifications will be loaded here -->
                </div>
            </div>
        </section>

        <!-- Settings -->
        <section id="page-settings" class="hidden space-y-6">
            <h2 class="text-3xl font-black uppercase text-white tracking-tighter">Core <span class="text-primary">Override</span></h2>
            <div class="content-glass p-8 rounded-[35px] max-w-2xl space-y-6">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Gateway UPI</label>
                        <input id="set-upi" type="text" class="input-dark" placeholder="payment@upi">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">QR Manifest URL</label>
                        <input id="set-qr" type="text" class="input-dark" placeholder="https://cdn.link/qr.jpg">
                    </div>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Telegram Channel Link</label>
                        <input id="set-telegram-channel" type="text" class="input-dark" placeholder="https://t.me/yourchannel">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Telegram Contact Link</label>
                        <input id="set-telegram-contact" type="text" class="input-dark" placeholder="https://t.me/yourusername">
                    </div>
                </div>
                
                <div class="bg-black/50 p-6 rounded-[25px] border border-white/5">
                    <div class="flex justify-between items-center mb-4">
                        <div>
                            <span class="text-[11px] font-black uppercase block text-white tracking-widest">Indo Dynamic Pricing</span>
                            <span class="text-[9px] text-gray-500 uppercase mt-1 block font-bold">Price increases by ₹1.5 daily from day 3</span>
                        </div>
                        <div class="text-right">
                            <span class="text-primary text-lg font-black">ACTIVE</span>
                        </div>
                    </div>
                    <p class="text-[9px] text-gray-400 leading-relaxed">
                        Indo products will automatically show "1 Day Old", "2 Days Old" etc. based on upload date.<br>
                        Price increases by ₹1.5 for each day after day 2 (starting from day 3).
                    </p>
                </div>
                
                <div class="flex justify-between items-center bg-black/50 p-6 rounded-[25px] border border-white/5">
                    <div>
                        <span class="text-[11px] font-black uppercase block text-white tracking-widest">System Lockdown</span>
                        <span class="text-[9px] text-gray-500 uppercase mt-1 block font-bold">Restrict all user traffic</span>
                    </div>
                    <label class="switch"><input type="checkbox" id="set-maint"><span class="slider"></span></label>
                </div>
                <button onclick="saveSettings()" class="w-full bg-primary py-4 rounded-[20px] font-black uppercase text-[11px] tracking-[0.3em] shadow-2xl">Deploy Changes</button>
            </div>
        </section>
    </main>

    <!-- Product Modal -->
    <div id="modal-product" class="fixed inset-0 z-[5000] bg-black/95 backdrop-blur-3xl hidden items-center justify-center p-4">
        <div class="content-glass w-full max-w-2xl rounded-[50px] p-10 space-y-6 overflow-y-auto max-h-[90vh] border border-white/10">
            <div class="flex justify-between items-center">
                <h3 id="p-modal-title" class="text-2xl font-black uppercase text-white tracking-tighter">Asset Entry</h3>
                <button onclick="closeModal('modal-product')" class="text-gray-500 hover:text-white transition"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <input type="hidden" id="p-id">
            
            <!-- Category Boxes - REMOVED "Other" Category -->
            <div class="space-y-2">
                <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-[0.2em]">Select Asset Classification</label>
                <div class="category-boxes" id="type-selector-grid">
                    <div onclick="selectProductType('indo', this)" class="category-box active" data-type="indo">
                        <i class="fa-brands fa-instagram"></i>
                        <span>Indo</span>
                    </div>
                    <div onclick="selectProductType('cc', this)" class="category-box" data-type="cc">
                        <i class="fa-solid fa-credit-card"></i>
                        <span>CC's</span>
                    </div>
                    <div onclick="selectProductType('method', this)" class="category-box" data-type="method">
                        <i class="fa-solid fa-fire"></i>
                        <span>Method</span>
                    </div>
                    <div onclick="selectProductType('bin', this)" class="category-box" data-type="bin">
                        <i class="fa-solid fa-microchip"></i>
                        <span>Bin</span>
                    </div>
                    <div onclick="selectProductType('paynow', this)" class="category-box" data-type="paynow">
                        <i class="fa-solid fa-bolt"></i>
                        <span>Pay Now</span>
                    </div>
                </div>
                <input type="hidden" id="p-type" value="indo">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div class="space-y-2">
                    <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Display Title</label>
                    <input id="p-title" type="text" class="input-dark" placeholder="e.g. Premium Account">
                </div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Base Price</label>
                        <input id="p-price" type="number" class="input-dark" placeholder="₹" value="100">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Available</label>
                        <input id="p-stock" type="number" class="input-dark" placeholder="Qty" value="1">
                    </div>
                </div>
            </div>

            <div class="space-y-2">
                <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Asset Description</label>
                <textarea id="p-desc" class="input-dark h-20" placeholder="Briefly describe the product..."></textarea>
            </div>

            <div class="space-y-2">
                <label class="text-[9px] font-black text-primary uppercase ml-2 tracking-widest">Encrypted Delivery Data</label>
                <textarea id="p-data" class="input-dark h-28 border-dashed border-primary/30 font-mono text-xs" placeholder="Accounts, Keys, or Redirection Links..."></textarea>
            </div>

            <div id="indo-dynamic-info" class="bg-primary/5 border border-primary/10 p-4 rounded-xl hidden">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fa-solid fa-clock-rotate-left text-primary"></i>
                    <p class="text-[9px] font-black text-primary uppercase">Indo Dynamic Pricing Active</p>
                </div>
                <p class="text-[8px] text-gray-400 leading-relaxed">
                    • This product will show "1 Day Old", "2 Days Old" etc. based on upload date<br>
                    • Price will increase by ₹1.5 for each day after day 2 (starting from day 3)<br>
                    • Example: Base ₹100 + 4 days old = ₹103 (₹1.5 × 2 days)
                </p>
            </div>

            <div class="flex gap-3 pt-3">
                <button onclick="closeModal('modal-product')" class="flex-1 py-4 bg-white/5 rounded-[20px] font-bold uppercase text-[9px] tracking-widest border border-white/5">Discard</button>
                <button onclick="saveProduct()" class="flex-1 py-4 bg-primary rounded-[20px] font-black uppercase text-[9px] tracking-widest shadow-2xl shadow-red-500/30">Save Asset</button>
            </div>
        </div>
    </div>

    <!-- Gallery Modal -->
    <div id="modal-gallery" class="fixed inset-0 z-[5000] bg-black/95 backdrop-blur-3xl hidden items-center justify-center p-4">
        <div class="content-glass w-full max-w-2xl rounded-[50px] p-10 space-y-6 overflow-y-auto max-h-[90vh] border border-white/10">
            <div class="flex justify-between items-center">
                <h3 id="g-modal-title" class="text-2xl font-black uppercase text-white tracking-tighter">Gallery Image</h3>
                <button onclick="closeModal('modal-gallery')" class="text-gray-500 hover:text-white transition"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <input type="hidden" id="g-id">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-5">
                <div class="space-y-2">
                    <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Image Title</label>
                    <input id="g-title" type="text" class="input-dark" placeholder="e.g. Premium Wallpaper">
                </div>
                <div class="space-y-2">
                    <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Image URL</label>
                    <input id="g-imageUrl" type="text" class="input-dark" placeholder="https://example.com/image.jpg">
                </div>
            </div>

            <div class="space-y-2">
                <label class="text-[9px] font-black text-gray-500 uppercase ml-2 tracking-widest">Description (Optional)</label>
                <textarea id="g-description" class="input-dark h-32" placeholder="Describe the image or add any notes..."></textarea>
            </div>

            <div class="bg-blue-500/5 border border-blue-500/10 p-4 rounded-xl">
                <div class="flex items-center gap-2 mb-1">
                    <i class="fa-solid fa-image text-blue-500"></i>
                    <p class="text-[9px] font-black text-blue-500 uppercase">Image Preview</p>
                </div>
                <div id="image-preview" class="mt-3 bg-black/50 border border-white/5 rounded-xl p-4 min-h-[150px] flex items-center justify-center">
                    <p class="text-gray-500 text-sm">Image preview will appear here</p>
                </div>
            </div>

            <div class="flex gap-3 pt-3">
                <button onclick="closeModal('modal-gallery')" class="flex-1 py-4 bg-white/5 rounded-[20px] font-bold uppercase text-[9px] tracking-widest border border-white/5">Discard</button>
                <button onclick="saveGalleryItem()" class="flex-1 py-4 bg-primary rounded-[20px] font-black uppercase text-[9px] tracking-widest shadow-2xl shadow-red-500/30">Save Image</button>
            </div>
        </div>
    </div>

    <!-- User Details Modal -->
    <div id="modal-user-details" class="fixed inset-0 z-[5000] bg-black/95 backdrop-blur-3xl hidden items-center justify-center p-4">
        <div class="content-glass w-full max-w-2xl rounded-[50px] p-10 space-y-6 overflow-y-auto max-h-[90vh] border border-white/10">
            <div class="flex justify-between items-center">
                <h3 id="user-modal-title" class="text-2xl font-black uppercase text-white tracking-tighter">User Details</h3>
                <button onclick="closeModal('modal-user-details')" class="text-gray-500 hover:text-white transition"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            <input type="hidden" id="user-uid">
            
            <div class="member-popup-grid">
                <div class="member-info-card">
                    <p class="member-info-label">User ID</p>
                    <p id="user-displayId" class="member-info-value">---</p>
                </div>
                <div class="member-info-card">
                    <p class="member-info-label">Account Status</p>
                    <p id="user-status" class="member-badge badge-active">Active</p>
                </div>
                <div class="member-info-card">
                    <p class="member-info-label">Full Name</p>
                    <p id="user-name" class="member-info-value">---</p>
                </div>
                <div class="member-info-card">
                    <p class="member-info-label">Email Address</p>
                    <p id="user-email" class="member-info-value">---</p>
                </div>
                <div class="member-info-card">
                    <p class="member-info-label">Current Balance</p>
                    <p id="user-balance" class="member-info-value text-green-500">₹0</p>
                </div>
                <div class="member-info-card">
                    <p class="member-info-label">Account Created</p>
                    <p id="user-created" class="member-info-value">---</p>
                </div>
                <div class="member-info-card">
                    <p class="member-info-label">Last Login</p>
                    <p id="user-lastLogin" class="member-info-value">---</p>
                </div>
                <div class="member-info-card">
                    <p class="member-info-label">User Type</p>
                    <p id="user-type" class="member-badge badge-admin">Admin</p>
                </div>
            </div>

            <div class="user-popup-actions">
                <button onclick="manageUserBalance('add')" class="user-action-btn action-success">
                    <i class="fa-solid fa-plus mr-1"></i> Add Balance
                </button>
                <button onclick="manageUserBalance('remove')" class="user-action-btn action-warning">
                    <i class="fa-solid fa-minus mr-1"></i> Remove Balance
                </button>
                <button onclick="toggleUserBan()" id="user-ban-btn" class="user-action-btn action-danger">
                    <i class="fa-solid fa-ban mr-1"></i> Ban User
                </button>
                <button onclick="resetUserPassword()" class="user-action-btn action-info">
                    <i class="fa-solid fa-key mr-1"></i> Reset Password
                </button>
                <button onclick="viewUserPurchases()" class="user-action-btn action-primary">
                    <i class="fa-solid fa-receipt mr-1"></i> View Purchases
                </button>
                <button onclick="deleteUserAccount()" class="user-action-btn action-danger">
                    <i class="fa-solid fa-trash mr-1"></i> Delete Account
                </button>
                <button onclick="makeUserAdmin()" id="user-admin-btn" class="user-action-btn action-info">
                    <i class="fa-solid fa-crown mr-1"></i> Make Admin
                </button>
                <button onclick="sendUserMessage()" class="user-action-btn action-info">
                    <i class="fa-solid fa-message mr-1"></i> Send Message
                </button>
            </div>

            <div class="pt-6 border-t border-white/5">
                <p class="text-[9px] text-gray-500 uppercase font-black tracking-[0.2em] mb-3">Quick Balance Adjustment</p>
                <div class="flex gap-3">
                    <input type="number" id="quick-balance-amount" class="input-dark flex-1" placeholder="Amount" value="100">
                    <button onclick="quickAddBalance()" class="bg-green-500 text-white px-6 py-3 rounded-xl font-black uppercase text-[9px] tracking-widest hover:bg-green-600 transition">Add</button>
                    <button onclick="quickRemoveBalance()" class="bg-red-500 text-white px-6 py-3 rounded-xl font-black uppercase text-[9px] tracking-widest hover:bg-red-600 transition">Remove</button>
                </div>
            </div>
            
            <div class="pt-6 border-t border-white/5">
                <p class="text-[9px] text-gray-500 uppercase font-black tracking-[0.2em] mb-3">Edit User Details</p>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <input type="text" id="edit-user-name" class="input-dark" placeholder="New Name">
                    <input type="email" id="edit-user-email" class="input-dark" placeholder="New Email">
                    <button onclick="updateUserDetails()" class="col-span-2 bg-primary text-white py-3 rounded-xl font-black uppercase text-[9px] tracking-widest hover:bg-primary/80 transition">
                        <i class="fa-solid fa-save mr-2"></i> Update Details
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="modal-order-details" class="fixed inset-0 z-[5000] bg-black/95 backdrop-blur-3xl hidden items-center justify-center p-4">
        <div class="content-glass w-full max-w-2xl rounded-[50px] p-10 space-y-6 overflow-y-auto max-h-[90vh] border border-white/10">
            <div class="flex justify-between items-center">
                <h3 class="text-2xl font-black uppercase text-white tracking-tighter">Order <span class="text-primary">Details</span></h3>
                <button onclick="closeModal('modal-order-details')" class="text-gray-500 hover:text-white transition"><i class="fa-solid fa-xmark text-xl"></i></button>
            </div>
            
            <div class="order-details-grid">
                <div class="order-detail-card">
                    <p class="order-detail-label">Transaction ID</p>
                    <p id="order-txid" class="order-detail-value">---</p>
                </div>
                <div class="order-detail-card">
                    <p class="order-detail-label">Purchase Date</p>
                    <p id="order-date" class="order-detail-value">---</p>
                </div>
                <div class="order-detail-card">
                    <p class="order-detail-label">Product Name</p>
                    <p id="order-product" class="order-detail-value">---</p>
                </div>
                <div class="order-detail-card">
                    <p class="order-detail-label">Product Category</p>
                    <p id="order-category" class="order-detail-value">---</p>
                </div>
                <div class="order-detail-card">
                    <p class="order-detail-label">Amount Paid</p>
                    <p id="order-amount" class="order-detail-value text-green-500">₹0</p>
                </div>
                <div class="order-detail-card">
                    <p class="order-detail-label">Base Price</p>
                    <p id="order-baseprice" class="order-detail-value">₹0</p>
                </div>
                <div class="order-detail-card">
                    <p class="order-detail-label">Daily Increase</p>
                    <p id="order-dailyincrease" class="order-detail-value text-yellow-500">₹0</p>
                </div>
                <div class="order-detail-card">
                    <p class="order-detail-label">Days Old</p>
                    <p id="order-daysold" class="order-detail-value">0</p>
                </div>
            </div>

            <div class="space-y-4">
                <div>
                    <p class="text-[9px] text-gray-500 uppercase font-black tracking-[0.2em] mb-2">User Information</p>
                    <div class="bg-black/30 p-4 rounded-xl">
                        <p class="text-sm text-white font-bold mb-1" id="order-username">---</p>
                        <p class="text-[10px] text-gray-400" id="order-useremail">---</p>
                        <p class="text-[8px] text-gray-600 mt-1" id="order-userid">UID: ---</p>
                    </div>
                </div>

                <div>
                    <p class="text-[9px] text-gray-500 uppercase font-black tracking-[0.2em] mb-2">Product Data</p>
                    <div class="data-view-box">
                        <p class="data-text" id="order-data">No data available</p>
                    </div>
                </div>
            </div>

            <div class="flex gap-3 pt-3">
                <button onclick="closeModal('modal-order-details')" class="flex-1 py-4 bg-white/5 rounded-[20px] font-bold uppercase text-[9px] tracking-widest border border-white/5">Close</button>
                <button onclick="copyOrderData()" class="flex-1 py-4 bg-primary rounded-[20px] font-black uppercase text-[9px] tracking-widest shadow-2xl shadow-red-500/30">
                    <i class="fa-regular fa-copy mr-2"></i> Copy Data
                </button>
            </div>
        </div>
    </div>

    <!-- Simple Login/Signup Screen -->
    <div id="auth-screen" class="login-container">
        <div class="login-card">
            <div class="login-header">
                <h1 class="text-4xl font-black uppercase tracking-tighter mb-2">
                    <span class="text-primary">NECXY</span>
                    <span class="text-white">PRO</span>
                </h1>
                <p class="text-[10px] font-bold text-gray-500 uppercase tracking-[4px]">Elite Admin Console</p>
                <p class="text-[9px] text-gray-600 mt-2 font-bold">SECURE ACCESS PANEL v2.0</p>
            </div>
            
            <div class="login-body">
                <div class="auth-tabs">
                    <div class="auth-tab active" onclick="switchAuthTab('login')">Login</div>
                    <div class="auth-tab" onclick="switchAuthTab('signup')">Create Admin</div>
                </div>
                
                <!-- Login Form -->
                <div id="login-form" class="auth-form">
                    <div class="input-group">
                        <label>Admin Email</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-user-shield"></i>
                            <input type="email" id="auth-email" placeholder="admin@necxy.com" autocomplete="username">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Password</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-lock"></i>
                            <input type="password" id="auth-pass" placeholder="••••••••" autocomplete="current-password">
                        </div>
                    </div>
                    
                    <button onclick="handleAuth()" id="auth-btn" class="btn-primary">
                        <span id="auth-btn-text">Login to Admin Panel</span>
                    </button>
                </div>
                
                <!-- Simple Signup Form -->
                <div id="signup-form" class="auth-form hidden">
                    <div class="input-group">
                        <label>Admin Name</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-id-card"></i>
                            <input type="text" id="auth-name" placeholder="Enter admin display name">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Admin Email</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-envelope"></i>
                            <input type="email" id="signup-email" placeholder="secure@admin.com">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Password</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-lock"></i>
                            <input type="password" id="signup-pass" placeholder="Minimum 8 characters">
                        </div>
                    </div>
                    
                    <div class="input-group">
                        <label>Confirm Password</label>
                        <div class="input-wrapper">
                            <i class="fa-solid fa-lock"></i>
                            <input type="password" id="signup-confirm" placeholder="Re-enter password">
                        </div>
                    </div>
                    
                    <button onclick="handleSignup()" id="signup-btn" class="btn-primary btn-green">
                        <span id="signup-btn-text">Create Admin Account</span>
                    </button>
                    
                    <p class="admin-secret-note">
                        <i class="fa-solid fa-triangle-exclamation mr-1"></i> Admin accounts have full system access
                    </p>
                </div>
            </div>
            
            <div class="login-footer">
                <p class="text-[9px] text-gray-600 font-bold">© 2024 NECXY PRO | ELITE ADMIN SYSTEM v2.0</p>
                <p class="text-[8px] text-gray-700 mt-2">All activities are logged and monitored</p>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, onValue, set, update, remove, push, runTransaction, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyAzGcDXubeeAdzlo8kfFa2naEilB3a7WAA",
            authDomain: "necxelgram.firebaseapp.com",
            projectId: "necxelgram",
            storageBucket: "necxelgram.firebasestorage.app",
            messagingSenderId: "259144804970",
            appId: "1:259144804970:web:9809fa52b6ff55f0f83813"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        let users = {}, products = {}, deposits = {}, requests = {}, gallery = {}, selectedUID = null, settings = {}, notifications = {};
        let currentDepositFilter = 'pending';
        let currentProductFilter = 'all';
        let selectedOrder = null;
        let uploadedImageFile = null;

        // Helper function to get product icon class (same as user panel)
        function getProductIconClass(type) {
            const t = (type || "").toLowerCase();
            if(t.includes('indo')) return { icon: 'fa-brands fa-instagram', color: 'icon-indo' };
            if(t.includes('bin')) return { icon: 'fa-solid fa-credit-card', color: 'icon-bin' };
            if(t.includes('cc')) return { icon: 'fa-solid fa-lock', color: 'icon-cc' };
            if(t.includes('pay')) return { icon: 'fa-solid fa-money-bill-wave', color: 'icon-paynow' };
            if(t.includes('method') || t.includes('tut')) return { icon: 'fa-solid fa-fire', color: 'icon-method' };
            return { icon: 'fa-solid fa-box', color: 'text-white' };
        }

        // Auth Tab Switching
        window.switchAuthTab = (tab) => {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.add('hidden'));
            
            if(tab === 'login') {
                document.querySelector('.auth-tab:nth-child(1)').classList.add('active');
                document.getElementById('login-form').classList.remove('hidden');
            } else {
                document.querySelector('.auth-tab:nth-child(2)').classList.add('active');
                document.getElementById('signup-form').classList.remove('hidden');
            }
        };

        // Broadcast Tab Switching
        window.switchBroadcastTab = (tab) => {
            // Hide all broadcast sections
            document.getElementById('broadcast-send').classList.add('hidden');
            document.getElementById('broadcast-history').classList.add('hidden');
            
            // Remove active class from all tabs
            document.querySelectorAll('.notification-tab').forEach(t => t.classList.remove('active'));
            
            // Show selected tab and add active class
            if(tab === 'send') {
                document.getElementById('broadcast-send').classList.remove('hidden');
                document.querySelector('.notification-tab:nth-child(1)').classList.add('active');
            } else {
                document.getElementById('broadcast-history').classList.remove('hidden');
                document.querySelector('.notification-tab:nth-child(2)').classList.add('active');
                renderNotifications();
            }
        };

        // Simple Signup
        window.handleSignup = async () => {
            const name = document.getElementById('auth-name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-pass').value;
            const confirm = document.getElementById('signup-confirm').value;
            
            if(!name || !email || !password || !confirm) {
                showToast("Fill all fields", 'error');
                return;
            }
            
            if(password !== confirm) {
                showToast("Passwords don't match", 'error');
                return;
            }
            
            if(password.length < 8) {
                showToast("Password must be at least 8 characters", 'error');
                return;
            }
            
            const btn = document.getElementById('signup-btn');
            const btnText = document.getElementById('signup-btn-text');
            const originalText = btnText.innerText;
            btnText.innerHTML = '<span class="loader mr-2"></span> Creating Admin...';
            btn.disabled = true;
            
            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                
                // Create admin user in database
                await set(ref(db, `users/${userCredential.user.uid}`), {
                    name: name,
                    email: email,
                    balance: 0,
                    displayId: Math.floor(100000 + Math.random() * 900000),
                    isAdmin: true,
                    isHidden: true,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                });
                
                showToast("Admin account created successfully!");
                switchAuthTab('login');
            } catch (error) {
                btnText.innerText = originalText;
                btn.disabled = false;
                if(error.code === 'auth/email-already-in-use') {
                    showToast("Email already registered", 'error');
                } else {
                    showToast("Signup failed: " + error.message, 'error');
                }
            }
        };

        // Handle Login
        window.handleAuth = async () => {
            const email = document.getElementById('auth-email').value;
            const password = document.getElementById('auth-pass').value;
            
            if(!email || !password) {
                showToast("Enter email and password", 'error');
                return;
            }
            
            const btn = document.getElementById('auth-btn');
            const btnText = document.getElementById('auth-btn-text');
            const originalText = btnText.innerText;
            btnText.innerHTML = '<span class="loader mr-2"></span> Authenticating...';
            btn.disabled = true;
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                showToast("Access Granted - Welcome Back");
            } catch (error) {
                btnText.innerText = originalText;
                btn.disabled = false;
                showToast("Invalid credentials", 'error');
            }
        };

        window.logoutAdmin = () => signOut(auth);

        onAuthStateChanged(auth, user => {
            if(user) { 
                document.getElementById('auth-screen').classList.add('hidden'); 
                initSync(); 
            } else { 
                document.getElementById('auth-screen').classList.remove('hidden'); 
            }
        });

        function initSync() {
            // Listen to users
            onValue(ref(db, 'users'), s => { 
                const data = s.val();
                users = {};
                if(data) {
                    Object.entries(data).forEach(([key, value]) => {
                        if(value && typeof value === 'object') {
                            // Only show non-hidden users in the list (except for current admin)
                            if(!value.isHidden || key === auth.currentUser?.uid) {
                                users[key] = value;
                            }
                        }
                    });
                }
                renderUsers(); 
                renderOrders(); 
                updateStats(); 
            });
            
            // Listen to products
            onValue(ref(db, 'products'), s => { 
                const data = s.val();
                products = {};
                if(data) {
                    if(Array.isArray(data)) {
                        products = data.reduce((acc, item, index) => {
                            if(item) {
                                acc[index] = { ...item, id: index.toString() };
                            }
                            return acc;
                        }, {});
                    } else {
                        products = Object.entries(data).reduce((acc, [key, value]) => {
                            if(value && typeof value === 'object') {
                                acc[key] = { ...value, id: key };
                            }
                            return acc;
                        }, {});
                    }
                } else {
                    products = {};
                }
                renderProducts(); 
            });
            
            // Listen to deposits - FIXED
            onValue(ref(db, 'deposits'), s => { 
                const data = s.val();
                deposits = {};
                if(data) {
                    if(Array.isArray(data)) {
                        data.forEach((item, index) => {
                            if(item && typeof item === 'object') {
                                deposits[index] = { ...item, id: index.toString() };
                            }
                        });
                    } else {
                        Object.entries(data).forEach(([key, value]) => {
                            if(value && typeof value === 'object') {
                                deposits[key] = { ...value, id: key };
                            }
                        });
                    }
                }
                console.log("Deposits loaded:", deposits);
                renderDeposits(); 
                updateStats(); 
            });
            
            // Listen to gallery
            onValue(ref(db, 'gallery'), s => { 
                const data = s.val();
                gallery = {};
                if(data) {
                    Object.entries(data).forEach(([key, value]) => {
                        if(value && typeof value === 'object') {
                            gallery[key] = { ...value, id: key };
                        }
                    });
                }
                renderGallery(); 
            });
            
            // Listen to requests
            onValue(ref(db, 'requests'), s => { 
                const data = s.val();
                requests = {};
                if(data) {
                    Object.entries(data).forEach(([key, value]) => {
                        if(value && typeof value === 'object') {
                            requests[key] = { ...value, id: key };
                        }
                    });
                }
                renderRequests(); 
                updateStats(); 
            });
            
            // Listen to notifications
            onValue(ref(db, 'notifications'), s => {
                const data = s.val();
                notifications = {};
                if(data) {
                    Object.entries(data).forEach(([key, value]) => {
                        if(value && typeof value === 'object') {
                            notifications[key] = { ...value, id: key };
                        }
                    });
                }
                // Update notifications list if we're on the broadcast page
                if(document.getElementById('page-broadcast') && !document.getElementById('page-broadcast').classList.contains('hidden')) {
                    renderNotifications();
                }
            });
            
            // Listen to settings
            onValue(ref(db, 'settings'), s => {
                settings = s.val() || {};
                document.getElementById('set-upi').value = settings.upi || '';
                document.getElementById('set-qr').value = settings.qrLink || '';
                document.getElementById('set-telegram-channel').value = settings.telegramChannel || '';
                document.getElementById('set-telegram-contact').value = settings.telegramContact || '';
                document.getElementById('set-maint').checked = settings.isMaintenance || false;
            });
        }

        // Helper function to format dates
        function getFormattedDate(dateString) {
            if (!dateString) return 'Never';
            try {
                const date = new Date(dateString);
                if (isNaN(date.getTime())) return 'Invalid Date';
                return date.toLocaleDateString('en-IN', {
                    day: '2-digit',
                    month: 'short',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch(e) {
                return dateString;
            }
        }

        // Inventory Filtering
        window.filterProducts = (category) => {
            currentProductFilter = category;
            
            // Update active button
            document.querySelectorAll('.inventory-nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Find and activate the clicked button
            const buttons = document.querySelectorAll('.inventory-nav-btn');
            buttons.forEach(btn => {
                if(btn.textContent.toLowerCase().includes(category) || 
                   (category === 'all' && btn.classList.contains('nav-btn-all'))) {
                    btn.classList.add('active');
                }
            });
            
            renderProducts();
        };

        // Product Category Selection
        window.selectProductType = (val, el) => {
            document.querySelectorAll('.category-box').forEach(box => box.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('p-type').value = val;
            
            // Show/hide Indo dynamic pricing info
            const indoInfo = document.getElementById('indo-dynamic-info');
            if(val === 'indo') {
                indoInfo.classList.remove('hidden');
            } else {
                indoInfo.classList.add('hidden');
            }
        };

        // Calculate product age and price (same as user panel)
        function getProductAge(addedOn) {
            if (!addedOn) return null;
            try {
                const uploadDate = new Date(addedOn);
                const now = new Date();
                const diffTime = Math.abs(now - uploadDate);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                if (diffDays >= 1) return `${diffDays} Day${diffDays > 1 ? 's' : ''} Old`;
                return null;
            } catch(e) {
                return null;
            }
        }

        // Get exact days since product was added
        function getDaysSinceAdded(addedOn) {
            if (!addedOn) return 0;
            try {
                const uploadDate = new Date(addedOn);
                const now = new Date();
                const diffTime = Math.abs(now - uploadDate);
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                return diffDays;
            } catch(e) {
                return 0;
            }
        }

        // Enhanced price calculation for Indo products with daily increase of ₹1.5
        function calculateDynamicPrice(p) {
            if (!p || !p.price) return 0;
            
            const basePrice = parseInt(p.price);
            const productType = (p.type || '').toLowerCase();
            
            // Apply daily increase only for Indo products
            if (productType.includes('indo')) {
                const daysSinceAdded = getDaysSinceAdded(p.addedOn);
                
                // Daily increase starts from 3rd day (day index 2)
                if (daysSinceAdded >= 2) {
                    const daysOfIncrease = daysSinceAdded - 1; // Start counting increases from day 3
                    const dailyIncreaseAmount = 1.5; // ₹1.5 increase per day
                    const totalIncrease = Math.floor(daysOfIncrease * dailyIncreaseAmount); // Round down to avoid decimals
                    
                    return basePrice + totalIncrease;
                }
            }
            
            // For non-Indo products, return base price
            return basePrice;
        }

        function getFormattedProductDate(rawDate) {
            if (!rawDate) return "No Date";
            try {
                const date = new Date(rawDate);
                if (isNaN(date.getTime())) return "Invalid Date";
                const day = date.getDate();
                const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                return `${day} ${months[date.getMonth()]} ${date.getFullYear()}`;
            } catch(e) {
                return rawDate;
            }
        }

        function updateStats() {
            const visibleUsers = Object.values(users).filter(u => !u.isHidden);
            document.getElementById('stat-users').innerText = visibleUsers.length;
            
            let total = 0; 
            Object.values(users).forEach(u => total += (u.balance || 0));
            document.getElementById('stat-balance').innerText = '₹' + total;
            
            const pendingRequests = Object.values(deposits).filter(d => 
                d.status === 'Processing' || !d.status || d.status === 'Pending'
            ).length;
            document.getElementById('stat-requests').innerText = pendingRequests;
        }

        // ENHANCED USER DETAILS MODAL WITH FULL FUNCTIONALITY
        window.openUserModal = (uid) => {
            const user = users[uid];
            if(!user) return;
            
            selectedUID = uid;
            document.getElementById('user-uid').value = uid;
            document.getElementById('user-modal-title').innerText = user.name || 'User Details';
            document.getElementById('user-displayId').innerText = user.displayId || uid.substring(0, 6);
            document.getElementById('user-name').innerText = user.name || 'No name';
            document.getElementById('user-email').innerText = user.email || 'No email';
            document.getElementById('user-balance').innerText = '₹' + (user.balance || 0);
            document.getElementById('user-created').innerText = getFormattedDate(user.createdAt);
            document.getElementById('user-lastLogin').innerText = getFormattedDate(user.lastLogin);
            document.getElementById('edit-user-name').value = user.name || '';
            document.getElementById('edit-user-email').value = user.email || '';
            
            // Update status badge
            const statusBadge = document.getElementById('user-status');
            const typeBadge = document.getElementById('user-type');
            
            if(user.isBanned) {
                statusBadge.className = 'member-badge badge-banned';
                statusBadge.innerText = 'Banned';
                document.getElementById('user-ban-btn').innerHTML = '<i class="fa-solid fa-check mr-1"></i> Unban User';
            } else {
                statusBadge.className = 'member-badge badge-active';
                statusBadge.innerText = 'Active';
                document.getElementById('user-ban-btn').innerHTML = '<i class="fa-solid fa-ban mr-1"></i> Ban User';
            }
            
            if(user.isAdmin) {
                typeBadge.className = 'member-badge badge-admin';
                typeBadge.innerText = 'Admin';
                document.getElementById('user-admin-btn').innerHTML = '<i class="fa-solid fa-user mr-1"></i> Remove Admin';
            } else {
                typeBadge.className = 'member-badge badge-active';
                typeBadge.innerText = 'User';
                document.getElementById('user-admin-btn').innerHTML = '<i class="fa-solid fa-crown mr-1"></i> Make Admin';
            }
            
            openModal('modal-user-details');
        };

        window.manageUserBalance = (action) => {
            const uid = document.getElementById('user-uid').value;
            const amount = prompt(`Enter amount to ${action}:`, "100");
            
            if(!amount || isNaN(amount) || amount <= 0) {
                showToast("Invalid amount", 'error');
                return;
            }
            
            const user = users[uid];
            if(!user) {
                showToast("User not found", 'error');
                return;
            }
            
            confirmAction(`${action === 'add' ? 'Add' : 'Remove'} ₹${amount} from ${user.name}'s balance?`, () => {
                const newBalance = action === 'add' ? 
                    (user.balance || 0) + parseInt(amount) : 
                    Math.max(0, (user.balance || 0) - parseInt(amount));
                
                update(ref(db, `users/${uid}`), { balance: newBalance }).then(() => {
                    showToast(`Balance ${action === 'add' ? 'added' : 'removed'} successfully`);
                    setTimeout(() => openUserModal(uid), 500);
                }).catch(error => {
                    showToast("Error updating balance", 'error');
                });
            });
        };

        window.toggleUserBan = () => {
            const uid = document.getElementById('user-uid').value;
            const user = users[uid];
            if(!user) return;
            
            const action = user.isBanned ? 'unban' : 'ban';
            confirmAction(`${action === 'ban' ? 'Ban' : 'Unban'} user ${user.name}?`, () => {
                update(ref(db, `users/${uid}`), { isBanned: !user.isBanned }).then(() => {
                    showToast(`User ${action === 'ban' ? 'banned' : 'unbanned'} successfully`);
                    setTimeout(() => openUserModal(uid), 500);
                }).catch(error => {
                    showToast("Error updating user", 'error');
                });
            });
        };

        window.makeUserAdmin = () => {
            const uid = document.getElementById('user-uid').value;
            const user = users[uid];
            if(!user) return;
            
            const action = user.isAdmin ? 'remove admin' : 'make admin';
            confirmAction(`${action === 'make admin' ? 'Make' : 'Remove'} ${user.name} as admin?`, () => {
                update(ref(db, `users/${uid}`), { isAdmin: !user.isAdmin }).then(() => {
                    showToast(`User ${action === 'make admin' ? 'made' : 'removed as'} admin successfully`);
                    setTimeout(() => openUserModal(uid), 500);
                }).catch(error => {
                    showToast("Error updating user", 'error');
                });
            });
        };

        window.deleteUserAccount = () => {
            const uid = document.getElementById('user-uid').value;
            const user = users[uid];
            
            confirmAction(`Permanently delete account of ${user.name}? This cannot be undone.`, () => {
                // Mark as hidden instead of deleting to preserve data integrity
                update(ref(db, `users/${uid}`), { isHidden: true }).then(() => {
                    showToast("User account deleted successfully");
                    closeModal('modal-user-details');
                    setTimeout(() => renderUsers(), 500);
                }).catch(error => {
                    showToast("Error deleting user", 'error');
                });
            });
        };

        window.quickAddBalance = () => {
            const uid = document.getElementById('user-uid').value;
            const amount = document.getElementById('quick-balance-amount').value;
            
            if(!amount || isNaN(amount) || amount <= 0) {
                showToast("Invalid amount", 'error');
                return;
            }
            
            const user = users[uid];
            if(!user) return;
            
            update(ref(db, `users/${uid}/balance`), (user.balance || 0) + parseInt(amount)).then(() => {
                showToast(`₹${amount} added to balance`);
                setTimeout(() => openUserModal(uid), 500);
            }).catch(error => {
                showToast("Error adding balance", 'error');
            });
        };

        window.quickRemoveBalance = () => {
            const uid = document.getElementById('user-uid').value;
            const amount = document.getElementById('quick-balance-amount').value;
            
            if(!amount || isNaN(amount) || amount <= 0) {
                showToast("Invalid amount", 'error');
                return;
            }
            
            const user = users[uid];
            if(!user) return;
            
            const newBalance = Math.max(0, (user.balance || 0) - parseInt(amount));
            
            update(ref(db, `users/${uid}`), { balance: newBalance }).then(() => {
                showToast(`₹${amount} removed from balance`);
                setTimeout(() => openUserModal(uid), 500);
            }).catch(error => {
                showToast("Error removing balance", 'error');
            });
        };

        window.updateUserDetails = () => {
            const uid = document.getElementById('user-uid').value;
            const newName = document.getElementById('edit-user-name').value.trim();
            const newEmail = document.getElementById('edit-user-email').value.trim();
            
            if(!newName) {
                showToast("Name cannot be empty", 'error');
                return;
            }
            
            if(!newEmail || !newEmail.includes('@')) {
                showToast("Valid email required", 'error');
                return;
            }
            
            confirmAction(`Update user details for ${users[uid]?.name}?`, () => {
                update(ref(db, `users/${uid}`), { 
                    name: newName,
                    email: newEmail
                }).then(() => {
                    showToast("User details updated successfully");
                    setTimeout(() => openUserModal(uid), 500);
                }).catch(error => {
                    showToast("Error updating details", 'error');
                });
            });
        };

        window.resetUserPassword = () => {
            const uid = document.getElementById('user-uid').value;
            const user = users[uid];
            
            showToast("Password reset initiated - Check Firebase console", 'info');
            // Note: Password reset requires Firebase Admin SDK on backend
        };

        window.viewUserPurchases = () => {
            const uid = document.getElementById('user-uid').value;
            const user = users[uid];
            
            if(!user || !user.purchaseHistory) {
                showToast("No purchase history found", 'info');
                return;
            }
            
            // Show purchase history in alert
            const purchases = Object.values(user.purchaseHistory || {});
            if(purchases.length === 0) {
                showToast("No purchases found", 'info');
                return;
            }
            
            let purchaseList = purchases.map(p => 
                `${p.title} - ₹${p.price} (${new Date(p.date).toLocaleDateString()})`
            ).join('\n');
            
            alert(`Purchase History for ${user.name}:\n\n${purchaseList}`);
        };

        window.sendUserMessage = () => {
            const uid = document.getElementById('user-uid').value;
            const user = users[uid];
            const message = prompt(`Send message to ${user.name}:`, "Hello, this is an admin message...");
            
            if(message && message.trim()) {
                // In a real app, you would save this to a messages collection
                showToast(`Message sent to ${user.name}`, 'success');
            }
        };

        window.renderUsers = () => {
            const q = document.getElementById('search-user')?.value.toLowerCase() || '';
            const container = document.getElementById('users-grid');
            let html = '';
            
            Object.entries(users).forEach(([uid, u]) => {
                if(!u || typeof u !== 'object') return;
                
                // Skip hidden admins in user list
                if(u.isHidden && uid !== auth.currentUser?.uid) return;
                
                const displayId = u.displayId || uid.substring(0, 6);
                const name = u.name || 'Anonymous Member';
                const email = u.email || '';
                
                if(name.toLowerCase().includes(q) || 
                   displayId.toString().toLowerCase().includes(q) || 
                   email.toLowerCase().includes(q)) {
                    const isCurrentUser = uid === auth.currentUser?.uid;
                    
                    html += `
                        <div onclick="openUserModal('${uid}')" class="content-glass p-6 rounded-[35px] border border-white/5 flex justify-between items-center cursor-pointer neo-card ${isCurrentUser ? 'border-primary/30' : ''}">
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-2xl ${u.isAdmin ? 'bg-primary/10' : 'bg-gray-500/10'} flex items-center justify-center font-black ${u.isAdmin ? 'text-primary' : 'text-gray-500'} border ${u.isAdmin ? 'border-primary/20' : 'border-gray-500/20'} text-lg relative">
                                    ${(name[0] || 'U').toUpperCase()}
                                    ${u.isAdmin ? '<i class="fa-solid fa-crown absolute -top-1 -right-1 text-xs text-primary"></i>' : ''}
                                </div>
                                <div>
                                    <h4 class="text-sm font-black text-white uppercase truncate w-28 tracking-tighter">${name}</h4>
                                    <p class="text-[8px] font-mono text-gray-600 uppercase tracking-widest mt-1 italic">UID: ${displayId}</p>
                                    ${email ? `<p class="text-[8px] text-gray-700 truncate w-28 mt-1">${email}</p>` : ''}
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-black ${u.isBanned ? 'text-red-500' : u.isAdmin ? 'text-primary' : 'text-green-500'} text-md italic">₹${u.balance || 0}</p>
                                ${u.isAdmin ? `<p class="text-[8px] text-primary uppercase font-bold mt-1">Admin</p>` : ''}
                                ${u.isBanned ? `<p class="text-[8px] text-red-500 uppercase font-bold mt-1">Banned</p>` : ''}
                            </div>
                        </div>`;
                }
            });
            
            container.innerHTML = html || '<div class="col-span-full py-16 text-center opacity-10 font-black uppercase tracking-[1em]">Empty Registry</div>';
        };

        // PRODUCT RENDERING - Same as User Panel
        window.renderProducts = () => {
            const q = document.getElementById('search-products')?.value.toLowerCase() || '';
            const container = document.getElementById('products-list');
            
            // Filter products based on current filter
            let filteredProducts = Object.entries(products);
            
            if(currentProductFilter !== 'all') {
                filteredProducts = filteredProducts.filter(([pid, p]) => {
                    if(!p || typeof p !== 'object') return false;
                    return p.type?.toLowerCase() === currentProductFilter;
                });
            }
            
            // Filter by search query
            filteredProducts = filteredProducts.filter(([pid, p]) => {
                if(!p || typeof p !== 'object') return false;
                
                const titleMatch = p.title?.toLowerCase().includes(q);
                const descMatch = p.desc?.toLowerCase().includes(q);
                const typeMatch = p.type?.toLowerCase().includes(q);
                
                return titleMatch || descMatch || typeMatch;
            });
            
            if(filteredProducts.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full py-16 text-center">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center mx-auto mb-4 border border-primary/20">
                            <i class="fa-solid fa-box-open text-2xl text-primary"></i>
                        </div>
                        <p class="text-gray-500 font-black uppercase tracking-[0.3em] text-sm">No assets found</p>
                        <p class="text-gray-600 text-[10px] mt-2">Try changing filters or search query</p>
                    </div>`;
                return;
            }
            
            let html = '';
            
            filteredProducts.forEach(([pid, p]) => {
                if(!p || typeof p !== 'object') return;
                
                const style = getProductIconClass(p.type);
                const originalDateTime = getFormattedProductDate(p.addedOn);
                const finalPrice = calculateDynamicPrice(p);
                const ageText = (p.type && p.type.toLowerCase().includes('indo')) ? getProductAge(p.addedOn) : null;
                const stock = parseInt(p.stock) || 0;
                const stockColor = stock > 10 ? 'text-green-500' : stock > 3 ? 'text-yellow-500' : 'text-red-500';
                const daysSinceAdded = getDaysSinceAdded(p.addedOn);
                const isIndo = p.type && p.type.toLowerCase().includes('indo');
                const hasDailyIncrease = isIndo && daysSinceAdded >= 2;
                
                html += `
                <div class="product-card p-4 flex items-center gap-4 group animate-fade-in" onclick="editProd('${pid}')">
                    <div class="w-14 h-14 rounded-xl bg-gradient-to-br from-black/40 to-black/60 flex items-center justify-center border border-white/5 transition-transform group-active:scale-90">
                        <i class="${style.icon} text-2xl ${style.color}"></i>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-0.5">
                            <span class="text-[7px] font-black text-white/40 uppercase tracking-widest bg-white/5 px-1.5 py-0.5 rounded-md">${p.type || 'Product'}</span>
                            ${ageText ? `<span class="text-[7px] font-black text-yellow-500 uppercase tracking-widest bg-yellow-500/10 px-1.5 py-0.5 rounded-md">${ageText}</span>` : ''}
                            <span class="text-[7px] font-bold ${stockColor} uppercase">Stock: ${stock}</span>
                            ${hasDailyIncrease ? `<span class="text-[7px] font-black text-red-500 uppercase tracking-widest bg-red-500/10 px-1.5 py-0.5 rounded-md">+₹1.5/day</span>` : ''}
                        </div>
                        <h3 class="font-bold text-[13px] text-white leading-tight truncate">${p.title || 'Untitled Product'}</h3>
                        <div class="flex flex-col">
                            <p class="text-[12px] font-black text-green-500 mt-0.5">₹${finalPrice}</p>
                            <p class="text-[8px] font-bold text-yellow-400 mt-1 uppercase tracking-tighter">${originalDateTime}</p>
                        </div>
                    </div>
                    <div class="flex flex-col gap-2">
                        <button onclick="event.stopPropagation(); editProd('${pid}')" class="w-8 h-8 rounded-full bg-blue-500/20 flex items-center justify-center text-blue-500 hover:bg-blue-500 hover:text-white transition">
                            <i class="fa-solid fa-pen text-[10px]"></i>
                        </button>
                        <button onclick="event.stopPropagation(); deleteProduct('${pid}')" class="w-8 h-8 rounded-full bg-red-500/20 flex items-center justify-center text-red-500 hover:bg-red-500 hover:text-white transition">
                            <i class="fa-solid fa-trash text-[10px]"></i>
                        </button>
                    </div>
                </div>`;
            });
            
            container.innerHTML = html;
        };

        window.deleteProduct = (pid) => {
            confirmAction('Are you sure you want to delete this product?', () => {
                remove(ref(db, `products/${pid}`)).then(() => {
                    showToast("Product deleted successfully");
                    setTimeout(() => renderProducts(), 500);
                }).catch(error => {
                    showToast("Failed to delete product", 'error');
                });
            });
        };

        window.openProductModal = () => {
            document.getElementById('p-id').value = '';
            document.getElementById('p-modal-title').innerText = "Add New Product";
            document.getElementById('p-title').value = '';
            document.getElementById('p-price').value = '100';
            document.getElementById('p-stock').value = '1';
            document.getElementById('p-desc').value = '';
            document.getElementById('p-data').value = '';
            
            const defaultType = 'indo';
            document.getElementById('p-type').value = defaultType;
            document.querySelectorAll('.category-box').forEach(box => {
                box.classList.remove('active');
                if(box.getAttribute('data-type') === defaultType) {
                    box.classList.add('active');
                }
            });
            
            // Show Indo dynamic pricing info by default
            document.getElementById('indo-dynamic-info').classList.remove('hidden');
            
            openModal('modal-product');
        };

        window.editProd = (pid) => {
            const p = products[pid];
            if(!p) return;
            
            document.getElementById('p-id').value = pid;
            document.getElementById('p-title').value = p.title || '';
            document.getElementById('p-price').value = p.price || '';
            document.getElementById('p-stock').value = p.stock || 0;
            document.getElementById('p-desc').value = p.desc || '';
            document.getElementById('p-data').value = p.data || '';
            document.getElementById('p-modal-title').innerText = "Edit Product";
            
            const type = p.type || 'indo';
            document.getElementById('p-type').value = type;
            
            document.querySelectorAll('.category-box').forEach(box => {
                box.classList.remove('active');
                if(box.getAttribute('data-type') === type) {
                    box.classList.add('active');
                }
            });
            
            // Show/hide Indo dynamic pricing info
            const indoInfo = document.getElementById('indo-dynamic-info');
            if(type === 'indo') {
                indoInfo.classList.remove('hidden');
            } else {
                indoInfo.classList.add('hidden');
            }
            
            openModal('modal-product');
        };

        window.saveProduct = () => {
            const id = document.getElementById('p-id').value;
            const title = document.getElementById('p-title').value.trim();
            const price = parseInt(document.getElementById('p-price').value);
            const stock = parseInt(document.getElementById('p-stock').value);
            const type = document.getElementById('p-type').value;
            const desc = document.getElementById('p-desc').value.trim();
            const data = document.getElementById('p-data').value.trim();
            
            if(!title) {
                showToast("Product title is required", 'error');
                return;
            }
            
            if(!price || price <= 0) {
                showToast("Valid price is required", 'error');
                return;
            }
            
            if(!stock || stock < 0) {
                showToast("Valid stock quantity is required", 'error');
                return;
            }
            
            const productData = {
                title,
                price,
                stock,
                type,
                desc,
                data,
                addedOn: new Date().toISOString()
            };
            
            const btn = document.querySelector('#modal-product button:last-child');
            const originalText = btn.innerText;
            btn.innerHTML = '<span class="loader"></span>';
            btn.disabled = true;
            
            if(id) {
                update(ref(db, `products/${id}`), productData).then(() => {
                    showToast("Product updated successfully");
                    closeModal('modal-product');
                    setTimeout(() => renderProducts(), 500);
                    btn.innerText = originalText;
                    btn.disabled = false;
                }).catch(error => {
                    showToast("Failed to update product", 'error');
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
            } else {
                const newProductRef = push(ref(db, 'products'));
                set(newProductRef, productData).then(() => {
                    showToast("Product added successfully");
                    closeModal('modal-product');
                    setTimeout(() => renderProducts(), 500);
                    btn.innerText = originalText;
                    btn.disabled = false;
                }).catch(error => {
                    showToast("Failed to add product", 'error');
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
            }
        };

        // Gallery Management
        window.openGalleryModal = () => {
            document.getElementById('g-id').value = '';
            document.getElementById('g-modal-title').innerText = "Add Gallery Image";
            document.getElementById('g-title').value = '';
            document.getElementById('g-imageUrl').value = '';
            document.getElementById('g-description').value = '';
            document.getElementById('image-preview').innerHTML = '<p class="text-gray-500 text-sm">Image preview will appear here</p>';
            
            openModal('modal-gallery');
        };

        window.editGalleryItem = (gid) => {
            const item = gallery[gid];
            if(!item) return;
            
            document.getElementById('g-id').value = gid;
            document.getElementById('g-modal-title').innerText = "Edit Gallery Image";
            document.getElementById('g-title').value = item.title || '';
            document.getElementById('g-imageUrl').value = item.imageUrl || '';
            document.getElementById('g-description').value = item.description || '';
            
            // Update image preview
            if(item.imageUrl) {
                document.getElementById('image-preview').innerHTML = `<img src="${item.imageUrl}" alt="${item.title}" class="max-h-32 rounded-lg mx-auto">`;
            }
            
            openModal('modal-gallery');
        };

        window.deleteGalleryItem = (gid) => {
            confirmAction('Delete this gallery image?', () => {
                remove(ref(db, `gallery/${gid}`)).then(() => {
                    showToast("Gallery image deleted");
                    setTimeout(() => renderGallery(), 500);
                }).catch(error => {
                    showToast("Error deleting image", 'error');
                });
            });
        };

        window.saveGalleryItem = () => {
            const id = document.getElementById('g-id').value;
            const title = document.getElementById('g-title').value.trim();
            const imageUrl = document.getElementById('g-imageUrl').value.trim();
            const description = document.getElementById('g-description').value.trim();
            
            if(!title) {
                showToast("Image title is required", 'error');
                return;
            }
            
            if(!imageUrl) {
                showToast("Image URL is required", 'error');
                return;
            }
            
            const galleryData = {
                title,
                imageUrl,
                description,
                uploadedAt: new Date().toISOString()
            };
            
            const btn = document.querySelector('#modal-gallery button:last-child');
            const originalText = btn.innerText;
            btn.innerHTML = '<span class="loader"></span>';
            btn.disabled = true;
            
            if(id) {
                update(ref(db, `gallery/${id}`), galleryData).then(() => {
                    showToast("Gallery image updated");
                    closeModal('modal-gallery');
                    setTimeout(() => renderGallery(), 500);
                    btn.innerText = originalText;
                    btn.disabled = false;
                }).catch(error => {
                    showToast("Failed to update image", 'error');
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
            } else {
                const newGalleryRef = push(ref(db, 'gallery'));
                set(newGalleryRef, galleryData).then(() => {
                    showToast("Gallery image added");
                    closeModal('modal-gallery');
                    setTimeout(() => renderGallery(), 500);
                    btn.innerText = originalText;
                    btn.disabled = false;
                }).catch(error => {
                    showToast("Failed to add image", 'error');
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
            }
        };

        window.renderGallery = () => {
            const q = document.getElementById('search-gallery')?.value.toLowerCase() || '';
            const container = document.getElementById('gallery-list');
            
            const allItems = Object.values(gallery);
            if(allItems.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full py-16 text-center">
                        <div class="w-16 h-16 bg-blue-500/10 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fa-solid fa-images text-2xl text-blue-500"></i>
                        </div>
                        <p class="text-gray-500 font-black uppercase tracking-[0.3em] text-sm">No gallery images</p>
                        <p class="text-gray-600 text-[10px] mt-2">Add your first image using the button above</p>
                    </div>`;
                return;
            }
            
            // Filter by search query
            const filteredItems = allItems.filter(item => {
                if(!item || typeof item !== 'object') return false;
                
                const titleMatch = item.title?.toLowerCase().includes(q);
                const descMatch = item.description?.toLowerCase().includes(q);
                
                return titleMatch || descMatch;
            });
            
            if(filteredItems.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full py-16 text-center">
                        <p class="text-gray-500 font-black uppercase tracking-[0.3em] text-sm">No images found</p>
                        <p class="text-gray-600 text-[10px] mt-2">Try a different search query</p>
                    </div>`;
                return;
            }
            
            let html = '';
            
            filteredItems.forEach(item => {
                const hasDescription = item.description && item.description.trim().length > 0;
                const uploadDate = getFormattedDate(item.uploadedAt);
                
                html += `
                    <div class="gallery-item">
                        <img src="${item.imageUrl}" alt="${item.title || 'Gallery Image'}" class="gallery-image" loading="lazy">
                        <div class="gallery-overlay">
                            <h3 class="text-sm font-black text-white truncate">${item.title || 'Untitled'}</h3>
                            ${hasDescription ? `<p class="gallery-description">${item.description}</p>` : ''}
                            <p class="text-[8px] text-gray-400 font-bold mt-2">${uploadDate}</p>
                        </div>
                        <div class="absolute top-2 right-2 flex gap-1">
                            <button onclick="editGalleryItem('${item.id}')" class="w-6 h-6 bg-blue-500/80 rounded-full flex items-center justify-center text-white text-[10px] hover:scale-110 transition">
                                <i class="fa-solid fa-pen"></i>
                            </button>
                            <button onclick="deleteGalleryItem('${item.id}')" class="w-6 h-6 bg-red-500/80 rounded-full flex items-center justify-center text-white text-[10px] hover:scale-110 transition">
                                <i class="fa-solid fa-trash"></i>
                            </button>
                        </div>
                    </div>`;
            });
            
            container.innerHTML = html;
        };

        // Live image preview
        document.getElementById('g-imageUrl')?.addEventListener('input', function() {
            const url = this.value.trim();
            const preview = document.getElementById('image-preview');
            
            if(url && (url.endsWith('.jpg') || url.endsWith('.jpeg') || url.endsWith('.png') || url.endsWith('.webp'))) {
                preview.innerHTML = `<img src="${url}" alt="Preview" class="max-h-32 rounded-lg mx-auto">`;
            } else if(url) {
                preview.innerHTML = '<p class="text-yellow-500 text-sm">Enter a valid image URL (jpg, png, webp)</p>';
            } else {
                preview.innerHTML = '<p class="text-gray-500 text-sm">Image preview will appear here</p>';
            }
        });

        // Enhanced Sales History with Order Details
        window.renderOrders = () => {
            const q = document.getElementById('search-orders')?.value.toLowerCase() || '';
            const container = document.getElementById('orders-list');
            
            let allOrders = [];
            
            // Collect all purchase histories from users
            Object.entries(users).forEach(([uid, user]) => {
                if(user.purchaseHistory && typeof user.purchaseHistory === 'object') {
                    Object.entries(user.purchaseHistory).forEach(([txId, order]) => {
                        if(order && typeof order === 'object') {
                            allOrders.push({
                                ...order,
                                uid: uid,
                                userName: user.name,
                                userEmail: user.email,
                                userDisplayId: user.displayId,
                                transactionId: txId
                            });
                        }
                    });
                }
            });
            
            // Sort by date (newest first)
            allOrders.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
            
            // Filter by search query
            const filteredOrders = allOrders.filter(order => {
                const titleMatch = order.title?.toLowerCase().includes(q);
                const userMatch = order.userName?.toLowerCase().includes(q);
                const uidMatch = order.userDisplayId?.toString().toLowerCase().includes(q);
                
                return titleMatch || userMatch || uidMatch;
            });
            
            if(filteredOrders.length === 0) {
                container.innerHTML = '<div class="py-16 text-center opacity-10 font-black uppercase tracking-[1em]">No sales records</div>';
                return;
            }
            
            let html = '';
            
            filteredOrders.forEach((order, index) => {
                const date = order.date ? getFormattedDate(order.date) : 'Unknown date';
                const isIndo = order.type && order.type.toLowerCase().includes('indo');
                
                html += `
                    <div onclick="viewOrderDetails(${index})" class="content-glass p-6 rounded-[35px] border border-white/5 flex justify-between items-center cursor-pointer neo-card hover:border-primary/30">
                        <div class="flex-1">
                            <div class="flex items-center gap-3 mb-3">
                                <div class="w-10 h-10 rounded-xl ${isIndo ? 'bg-purple-500/10' : 'bg-green-500/10'} flex items-center justify-center ${isIndo ? 'text-purple-500' : 'text-green-500'}">
                                    <i class="fa-solid ${isIndo ? 'fa-brands fa-instagram' : 'fa-box'}"></i>
                                </div>
                                <div>
                                    <p class="text-lg font-black text-white uppercase italic tracking-tighter">${order.userName || 'Unknown User'}</p>
                                    <p class="text-[9px] text-gray-500 font-mono mt-1 uppercase">UID: ${order.userDisplayId || 'N/A'}</p>
                                </div>
                            </div>
                            <div class="space-y-1">
                                <div class="flex justify-between items-center">
                                    <span class="text-[9px] text-gray-500 uppercase font-bold">Product</span>
                                    <span class="text-[9px] font-black text-white truncate max-w-[150px]">${order.title || 'Unknown Product'}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-[9px] text-gray-500 uppercase font-bold">Date</span>
                                    <span class="text-[9px] text-white">${date}</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-[9px] text-gray-500 uppercase font-bold">Type</span>
                                    <span class="text-[9px] font-black ${isIndo ? 'text-purple-500' : 'text-green-500'} uppercase">${order.type || 'Other'}</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right ml-4">
                            <p class="text-3xl font-black text-white italic">₹${order.price || 0}</p>
                            ${isIndo && order.dailyIncrease > 0 ? `
                                <p class="text-[8px] text-yellow-500 font-bold mt-1">
                                    Base: ₹${order.basePrice || 0}<br>
                                    +₹${order.dailyIncrease || 0} daily
                                </p>
                            ` : ''}
                        </div>
                    </div>`;
                
                // Store order reference
                window.orderCache = window.orderCache || [];
                window.orderCache[index] = order;
            });
            
            container.innerHTML = html;
        };

        window.viewOrderDetails = (index) => {
            const order = window.orderCache?.[index];
            if(!order) return;
            
            selectedOrder = order;
            
            document.getElementById('order-txid').innerText = order.transactionId || 'N/A';
            document.getElementById('order-date').innerText = getFormattedDate(order.date);
            document.getElementById('order-product').innerText = order.title || 'Unknown Product';
            document.getElementById('order-category').innerText = order.type || 'Other';
            document.getElementById('order-amount').innerText = `₹${order.price || 0}`;
            document.getElementById('order-baseprice').innerText = `₹${order.basePrice || 0}`;
            document.getElementById('order-dailyincrease').innerText = `₹${order.dailyIncrease || 0}`;
            document.getElementById('order-daysold').innerText = order.dailyIncrease > 0 ? Math.floor(order.dailyIncrease / 1.5) + 2 : 'N/A';
            document.getElementById('order-username').innerText = order.userName || 'Unknown User';
            document.getElementById('order-useremail').innerText = order.userEmail || 'No email';
            document.getElementById('order-userid').innerText = `UID: ${order.userDisplayId || 'N/A'}`;
            document.getElementById('order-data').innerText = order.data || 'No data available';
            
            openModal('modal-order-details');
        };

        window.copyOrderData = () => {
            if(!selectedOrder || !selectedOrder.data) {
                showToast("No data to copy", 'error');
                return;
            }
            
            navigator.clipboard.writeText(selectedOrder.data).then(() => {
                showToast("Product data copied to clipboard");
            }).catch(error => {
                showToast("Failed to copy data", 'error');
            });
        };

        window.clearSalesHistory = () => {
            confirmAction('This will clear ALL sales history from ALL users. Continue?', () => {
                // Clear purchase history from all users
                const updates = {};
                Object.keys(users).forEach(uid => {
                    updates[`users/${uid}/purchaseHistory`] = null;
                });
                
                update(ref(db), updates).then(() => {
                    showToast("Sales history cleared");
                    setTimeout(() => renderOrders(), 500);
                }).catch(error => {
                    showToast("Error clearing history", 'error');
                });
            });
        };

        // FIXED DEPOSIT RENDERING
        window.renderDeposits = (filter = 'pending') => {
            currentDepositFilter = filter;
            
            // Update filter button styles
            document.querySelectorAll('#page-deposits .grid button').forEach(btn => {
                btn.classList.remove('bg-primary', 'text-white');
                btn.classList.add('bg-white/5', 'text-gray-400');
            });
            
            const activeBtn = document.getElementById(`filter-${filter}`);
            if(activeBtn) {
                activeBtn.classList.remove('bg-white/5', 'text-gray-400');
                activeBtn.classList.add('bg-primary', 'text-white');
            }
            
            const container = document.getElementById('deposit-list');
            let html = '';
            
            const allDeposits = Object.values(deposits);
            
            if(allDeposits.length === 0) {
                container.innerHTML = '<div class="py-16 text-center opacity-10 font-black uppercase tracking-[1em]">No deposit requests</div>';
                return;
            }
            
            // Filter deposits
            let filteredDeposits = allDeposits;
            if(filter === 'pending') {
                filteredDeposits = allDeposits.filter(d => 
                    !d.status || d.status === 'Processing' || d.status === 'Pending'
                );
            } else if(filter === 'approved') {
                filteredDeposits = allDeposits.filter(d => d.status === 'Approved' || d.status === 'Completed');
            } else if(filter === 'rejected') {
                filteredDeposits = allDeposits.filter(d => d.status === 'Rejected');
            }
            
            // Sort by date (newest first)
            filteredDeposits.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
            
            filteredDeposits.forEach(d => {
                if(!d || typeof d !== 'object') return;
                
                const user = users[d.uid];
                const userName = user?.name || d.userName || 'Unknown User';
                const userDisplayId = user?.displayId || d.uid?.substring(0, 6) || 'N/A';
                const amount = d.amount || 0;
                const status = d.status || 'Processing';
                const date = d.date ? new Date(d.date).toLocaleString() : 'Unknown date';
                const utr = d.utr || 'No UTR';
                const depositId = d.id || '';
                
                let statusColor = 'text-yellow-500';
                let statusText = 'Pending';
                let statusBg = 'bg-yellow-500/10';
                
                if(status === 'Approved' || status === 'Completed') {
                    statusColor = 'text-green-500';
                    statusText = 'Approved';
                    statusBg = 'bg-green-500/10';
                } else if(status === 'Rejected') {
                    statusColor = 'text-red-500';
                    statusText = 'Rejected';
                    statusBg = 'bg-red-500/10';
                }
                
                html += `
                    <div class="content-glass p-6 rounded-[35px] border border-white/5 neo-card">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 rounded-xl ${statusBg} flex items-center justify-center ${statusColor}">
                                        <i class="fa-solid fa-indian-rupee-sign"></i>
                                    </div>
                                    <div>
                                        <p class="text-lg font-black text-white uppercase italic tracking-tighter">${userName}</p>
                                        <p class="text-[9px] text-gray-500 font-mono mt-1 uppercase">UID: ${userDisplayId}</p>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <div class="flex justify-between items-center">
                                        <span class="text-[9px] text-gray-500 uppercase font-bold">UTR / Reference</span>
                                        <span class="text-[9px] font-mono text-primary bg-primary/5 px-2 py-1 rounded-full">${utr}</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-[9px] text-gray-500 uppercase font-bold">Date</span>
                                        <span class="text-[9px] text-white">${date}</span>
                                    </div>
                                </div>
                            </div>
                            <div class="text-right ml-4">
                                <p class="text-3xl font-black text-white italic">₹${amount}</p>
                                <p class="text-[9px] ${statusColor} font-black uppercase mt-1 bg-black/30 px-2 py-1 rounded-full">${statusText}</p>
                            </div>
                        </div>
                        <div class="flex gap-2 pt-3 border-t border-white/5">
                            ${status === 'Processing' || status === 'Pending' || !status ? `
                                <button onclick="procDep('${depositId}', '${d.uid}', ${amount}, true)" class="flex-1 bg-green-600 py-2.5 rounded-[18px] font-black uppercase text-[9px] tracking-widest shadow-xl shadow-green-500/20 hover:bg-green-700 transition">✓ Approve</button>
                                <button onclick="procDep('${depositId}', '${d.uid}', ${amount}, false)" class="flex-1 bg-white/5 border border-white/10 py-2.5 rounded-[18px] font-black uppercase text-[9px] tracking-widest hover:bg-white/10 transition">✗ Reject</button>
                            ` : ''}
                            <button onclick="deleteDeposit('${depositId}')" class="delete-deposit-btn">
                                <i class="fa-solid fa-trash mr-1"></i> Delete
                            </button>
                        </div>
                    </div>`;
            });
            
            container.innerHTML = html || '<div class="py-16 text-center opacity-10 font-black uppercase tracking-[1em]">No deposits found</div>';
        };

        window.deleteDeposit = (did) => {
            confirmAction('Delete this deposit record permanently?', () => {
                remove(ref(db, `deposits/${did}`)).then(() => {
                    showToast("Deposit record deleted");
                    setTimeout(() => renderDeposits(currentDepositFilter), 500);
                }).catch(error => {
                    showToast("Error deleting deposit", 'error');
                });
            });
        };

        window.procDep = (did, uid, amt, approve) => {
            if(!did || !uid) return;
            
            if(approve) {
                runTransaction(ref(db, `users/${uid}/balance`), (b) => {
                    return (b || 0) + amt;
                }).then(() => {
                    update(ref(db, `deposits/${did}`), { 
                        status: 'Approved',
                        processedAt: new Date().toLocaleString()
                    }).then(() => {
                        showToast("Deposit approved and balance added");
                        setTimeout(() => renderDeposits(currentDepositFilter), 500);
                    });
                }).catch(error => {
                    showToast("Error approving deposit", 'error');
                });
            } else {
                update(ref(db, `deposits/${did}`), { 
                    status: 'Rejected',
                    processedAt: new Date().toLocaleString()
                }).then(() => {
                    showToast("Deposit rejected");
                    setTimeout(() => renderDeposits(currentDepositFilter), 500);
                }).catch(error => {
                    showToast("Error rejecting deposit", 'error');
                });
            }
        };

        // User Requests Management
        window.renderRequests = () => {
            const q = document.getElementById('search-requests')?.value.toLowerCase() || '';
            const container = document.getElementById('requests-list');
            
            const allRequests = Object.values(requests);
            if(allRequests.length === 0) {
                container.innerHTML = '<div class="py-16 text-center opacity-10 font-black uppercase tracking-[1em]">No requests from users</div>';
                return;
            }
            
            // Sort by date (newest first)
            allRequests.sort((a, b) => new Date(b.date || 0) - new Date(a.date || 0));
            
            let html = '';
            
            allRequests.forEach(r => {
                if(!r || typeof r !== 'object') return;
                
                const user = users[r.uid];
                const userName = user?.name || 'Unknown User';
                const userDisplayId = user?.displayId || r.uid?.substring(0, 6) || 'N/A';
                const requestText = r.text || 'No message';
                const date = r.date ? new Date(r.date).toLocaleString() : 'Unknown date';
                const requestId = r.id || '';
                
                if(!requestText.toLowerCase().includes(q)) return;
                
                html += `
                    <div class="content-glass p-6 rounded-[35px] border border-white/5 neo-card">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-3 mb-3">
                                    <div class="w-10 h-10 rounded-xl bg-blue-500/10 flex items-center justify-center text-blue-500">
                                        <i class="fa-solid fa-comment"></i>
                                    </div>
                                    <div>
                                        <p class="text-lg font-black text-white uppercase italic tracking-tighter">${userName}</p>
                                        <p class="text-[9px] text-gray-500 font-mono mt-1 uppercase">UID: ${userDisplayId}</p>
                                    </div>
                                </div>
                                <div class="space-y-1">
                                    <div class="flex justify-between items-center">
                                        <span class="text-[9px] text-gray-500 uppercase font-bold">Request</span>
                                        <span class="text-[9px] text-white font-bold">${date}</span>
                                    </div>
                                    <div class="bg-black/30 p-3 rounded-xl mt-2">
                                        <p class="text-sm text-gray-300 leading-relaxed">${requestText}</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flex gap-2 pt-3 border-t border-white/5">
                            <button onclick="deleteRequest('${requestId}')" class="flex-1 bg-red-600/10 text-red-500 py-2.5 rounded-[18px] font-black uppercase text-[9px] tracking-widest hover:bg-red-600 hover:text-white transition">Delete</button>
                            <button onclick="markAsDone('${requestId}')" class="flex-1 bg-green-600/10 text-green-500 py-2.5 rounded-[18px] font-black uppercase text-[9px] tracking-widest hover:bg-green-600 hover:text-white transition">Mark Done</button>
                        </div>
                    </div>`;
            });
            
            container.innerHTML = html || '<div class="py-16 text-center opacity-10 font-black uppercase tracking-[1em]">No requests found</div>';
        };

        window.deleteRequest = (requestId) => {
            confirmAction('Delete this user request?', () => {
                remove(ref(db, `requests/${requestId}`)).then(() => {
                    showToast("Request deleted");
                    setTimeout(() => renderRequests(), 500);
                }).catch(error => {
                    showToast("Error deleting request", 'error');
                });
            });
        };

        window.markAsDone = (requestId) => {
            confirmAction('Mark this request as completed?', () => {
                update(ref(db, `requests/${requestId}`), { 
                    status: 'Completed',
                    completedAt: new Date().toLocaleString()
                }).then(() => {
                    showToast("Request marked as completed");
                    setTimeout(() => renderRequests(), 500);
                }).catch(error => {
                    showToast("Error updating request", 'error');
                });
            });
        };

        window.clearAllRequests = () => {
            confirmAction('Clear all user requests? This cannot be undone.', () => {
                remove(ref(db, 'requests')).then(() => {
                    showToast("All requests cleared");
                    setTimeout(() => renderRequests(), 500);
                }).catch(error => {
                    showToast("Error clearing requests", 'error');
                });
            });
        };

        // BROADCAST NOTIFICATION FUNCTIONS
        window.updateCharCount = () => {
            const message = document.getElementById('broadcast-message').value;
            const charCount = document.getElementById('char-count');
            const count = message.length;
            charCount.innerText = `${count}/500`;
            
            // Update color based on length
            charCount.className = 'char-counter';
            if(count > 450) {
                charCount.classList.add('warning');
            }
            if(count > 490) {
                charCount.classList.add('error');
            }
        };

        window.updatePreview = () => {
            const subject = document.getElementById('broadcast-subject').value || 'Your Subject Will Appear Here';
            const message = document.getElementById('broadcast-message').value || 'Your message will appear here. Users will see this in their notifications panel.';
            const imageUrl = document.getElementById('broadcast-image').value;
            const previewImage = document.getElementById('preview-image');
            const previewImageContainer = document.getElementById('preview-image-container');
            const previewSubject = document.getElementById('preview-subject');
            const previewMessage = document.getElementById('preview-message');
            const notificationTypeBadge = document.querySelector('#notification-preview .notification-type-badge');
            
            previewSubject.innerText = subject;
            previewMessage.innerText = message;
            
            if(imageUrl && imageUrl.trim() !== '') {
                previewImage.src = imageUrl;
                previewImageContainer.classList.remove('hidden');
                notificationTypeBadge.className = 'notification-type-badge badge-with-image';
                notificationTypeBadge.innerText = 'With Image';
            } else {
                previewImageContainer.classList.add('hidden');
                notificationTypeBadge.className = 'notification-type-badge badge-text-only';
                notificationTypeBadge.innerText = 'Text Only';
            }
            
            showToast("Preview updated", 'info');
        };

        window.handleDragOver = (event) => {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('image-upload-area').classList.add('dragover');
        };

        window.handleDrop = (event) => {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('image-upload-area').classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            if(files.length > 0) {
                handleImageFile(files[0]);
            }
        };

        window.handleImageUpload = (event) => {
            const file = event.target.files[0];
            if(file) {
                handleImageFile(file);
            }
        };

        function handleImageFile(file) {
            // Check if file is an image
            if(!file.type.match('image.*')) {
                showToast("Please upload an image file", 'error');
                return;
            }
            
            // Check file size (max 5MB)
            if(file.size > 5 * 1024 * 1024) {
                showToast("Image size should be less than 5MB", 'error');
                return;
            }
            
            uploadedImageFile = file;
            
            // Create a local URL for the image preview
            const imageUrl = URL.createObjectURL(file);
            
            // Show image preview
            document.getElementById('image-preview-container').classList.remove('hidden');
            document.getElementById('broadcast-image-preview').src = imageUrl;
            
            // Set the image URL input to the local URL (for preview)
            document.getElementById('broadcast-image').value = imageUrl;
            
            showToast("Image uploaded successfully", 'success');
            updatePreview();
        };

        window.removeUploadedImage = () => {
            uploadedImageFile = null;
            document.getElementById('image-preview-container').classList.add('hidden');
            document.getElementById('broadcast-image').value = '';
            document.getElementById('image-upload-input').value = '';
            
            showToast("Image removed", 'info');
            updatePreview();
        };

        window.sendBroadcastNotification = () => {
            const subject = document.getElementById('broadcast-subject').value.trim();
            const message = document.getElementById('broadcast-message').value.trim();
            let imageUrl = document.getElementById('broadcast-image').value.trim();
            
            if(!subject) {
                showToast("Please enter a subject", 'error');
                return;
            }
            
            if(!message) {
                showToast("Please enter a message", 'error');
                return;
            }
            
            // Check if we have an uploaded file
            if(uploadedImageFile) {
                // In a real app, you would upload to Firebase Storage here
                // For now, we'll use a placeholder or ask for a URL
                if(!imageUrl || imageUrl.startsWith('blob:')) {
                    showToast("Please provide a permanent image URL or remove the image", 'error');
                    return;
                }
            }
            
            const currentUser = auth.currentUser;
            if(!currentUser) {
                showToast("You must be logged in to send notifications", 'error');
                return;
            }
            
            const notificationData = {
                subject: subject,
                message: message,
                imageUrl: imageUrl || '',
                sentBy: currentUser.uid,
                sentByName: users[currentUser.uid]?.name || 'Admin',
                sentAt: new Date().toISOString(),
                isActive: true,
                type: imageUrl ? 'withImage' : 'textOnly'
            };
            
            confirmAction(`Send this notification to all ${Object.keys(users).length} users?`, () => {
                const btn = document.querySelector('#broadcast-send button:last-child');
                const originalText = btn.innerText;
                btn.innerHTML = '<span class="loader"></span>';
                btn.disabled = true;
                
                // Save notification to database
                const newNotificationRef = push(ref(db, 'notifications'));
                set(newNotificationRef, notificationData).then(() => {
                    showToast(`Notification sent to all users!`, 'success');
                    
                    // Clear form
                    document.getElementById('broadcast-subject').value = '';
                    document.getElementById('broadcast-message').value = '';
                    document.getElementById('broadcast-image').value = '';
                    document.getElementById('char-count').innerText = '0/500';
                    removeUploadedImage();
                    updatePreview();
                    
                    // Switch to history tab
                    switchBroadcastTab('history');
                    
                    btn.innerText = originalText;
                    btn.disabled = false;
                }).catch(error => {
                    showToast("Failed to send notification: " + error.message, 'error');
                    btn.innerText = originalText;
                    btn.disabled = false;
                });
            });
        };

        window.renderNotifications = () => {
            const q = document.getElementById('search-notifications')?.value.toLowerCase() || '';
            const container = document.getElementById('notifications-list');
            
            const allNotifications = Object.values(notifications);
            if(allNotifications.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full py-16 text-center">
                        <div class="w-16 h-16 rounded-full bg-gradient-to-br from-primary/10 to-primary/5 flex items-center justify-center mx-auto mb-4 border border-primary/20">
                            <i class="fa-solid fa-bullhorn text-2xl text-primary"></i>
                        </div>
                        <p class="text-gray-500 font-black uppercase tracking-[0.3em] text-sm">No notifications sent yet</p>
                        <p class="text-gray-600 text-[10px] mt-2">Send your first notification using the "New Notification" button</p>
                    </div>`;
                return;
            }
            
            // Sort by date (newest first)
            allNotifications.sort((a, b) => new Date(b.sentAt || 0) - new Date(a.sentAt || 0));
            
            let html = '';
            
            allNotifications.forEach(notification => {
                if(!notification || typeof notification !== 'object') return;
                
                const subject = notification.subject || 'No Subject';
                const message = notification.message || '';
                const imageUrl = notification.imageUrl || '';
                const sentAt = getFormattedDate(notification.sentAt);
                const sentByName = notification.sentByName || 'Admin';
                const notificationId = notification.id || '';
                const type = notification.type || 'textOnly';
                
                // Filter by search query
                if(!subject.toLowerCase().includes(q) && !message.toLowerCase().includes(q)) return;
                
                html += `
                    <div class="notification-card animate-fade-in">
                        <div class="notification-header">
                            <span class="notification-type-badge ${type === 'withImage' ? 'badge-with-image' : 'badge-text-only'}">
                                ${type === 'withImage' ? 'With Image' : 'Text Only'}
                            </span>
                            <span class="notification-sent-badge">${sentAt}</span>
                        </div>
                        <h3 class="text-lg font-black text-white mb-2">${subject}</h3>
                        <p class="text-sm text-gray-300 mb-3">${message}</p>
                        ${imageUrl ? `<img src="${imageUrl}" alt="${subject}" class="notification-image">` : ''}
                        <div class="flex justify-between items-center mt-4">
                            <p class="text-[8px] text-gray-500">Sent by <span class="text-primary font-bold">${sentByName}</span></p>
                            <div class="notification-actions">
                                <button onclick="resendNotification('${notificationId}')" class="notification-action-btn action-send">
                                    <i class="fa-solid fa-paper-plane mr-1"></i> Resend
                                </button>
                                <button onclick="deleteNotification('${notificationId}')" class="notification-action-btn action-delete">
                                    <i class="fa-solid fa-trash mr-1"></i> Delete
                                </button>
                            </div>
                        </div>
                    </div>`;
            });
            
            container.innerHTML = html || '<div class="py-16 text-center opacity-10 font-black uppercase tracking-[1em]">No notifications found</div>';
        };

        window.resendNotification = (notificationId) => {
            const notification = notifications[notificationId];
            if(!notification) return;
            
            confirmAction(`Resend this notification to all users?`, () => {
                // Create a new notification with current timestamp
                const currentUser = auth.currentUser;
                const resendData = {
                    ...notification,
                    sentBy: currentUser.uid,
                    sentByName: users[currentUser.uid]?.name || 'Admin',
                    sentAt: new Date().toISOString(),
                    id: null // Remove ID so a new one is generated
                };
                
                delete resendData.id;
                
                const newNotificationRef = push(ref(db, 'notifications'));
                set(newNotificationRef, resendData).then(() => {
                    showToast("Notification resent to all users", 'success');
                    setTimeout(() => renderNotifications(), 500);
                }).catch(error => {
                    showToast("Failed to resend notification", 'error');
                });
            });
        };

        window.deleteNotification = (notificationId) => {
            confirmAction('Delete this notification permanently?', () => {
                remove(ref(db, `notifications/${notificationId}`)).then(() => {
                    showToast("Notification deleted");
                    setTimeout(() => renderNotifications(), 500);
                }).catch(error => {
                    showToast("Error deleting notification", 'error');
                });
            });
        };

        window.saveSettings = () => {
            const upi = document.getElementById('set-upi').value.trim();
            const qrLink = document.getElementById('set-qr').value.trim();
            const telegramChannel = document.getElementById('set-telegram-channel').value.trim();
            const telegramContact = document.getElementById('set-telegram-contact').value.trim();
            const isMaintenance = document.getElementById('set-maint').checked;
            
            const settingsData = {
                upi: upi,
                qrLink: qrLink,
                telegramChannel: telegramChannel,
                telegramContact: telegramContact,
                isMaintenance: isMaintenance
            };
            
            const btn = document.querySelector('#page-settings button:last-child');
            const originalText = btn.innerText;
            btn.innerHTML = '<span class="loader"></span>';
            btn.disabled = true;
            
            update(ref(db, 'settings'), settingsData).then(() => {
                showToast("Settings saved successfully");
                btn.innerText = originalText;
                btn.disabled = false;
            }).catch(error => {
                showToast("Failed to save settings", 'error');
                btn.innerText = originalText;
                btn.disabled = false;
            });
        };

        window.switchTab = (id) => {
            document.querySelectorAll('main section').forEach(s => s.classList.add('hidden'));
            document.getElementById(`page-${id}`).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(`nav-${id}`).classList.add('active');
            
            if(window.innerWidth < 768) {
                toggleSidebar();
            }
            
            if(id === 'products') {
                setTimeout(() => {
                    renderProducts();
                    // Reset to all view
                    filterProducts('all');
                }, 100);
            }
            if(id === 'orders') setTimeout(() => renderOrders(), 100);
            if(id === 'users') setTimeout(() => renderUsers(), 100);
            if(id === 'deposits') setTimeout(() => renderDeposits(currentDepositFilter), 100);
            if(id === 'gallery') setTimeout(() => renderGallery(), 100);
            if(id === 'requests') setTimeout(() => renderRequests(), 100);
            if(id === 'broadcast') {
                setTimeout(() => {
                    switchBroadcastTab('send');
                    updatePreview();
                }, 100);
            }
        };

        window.toggleSidebar = () => {
            const s = document.getElementById('main-sidebar');
            s.classList.toggle('sidebar-mobile-hidden');
            s.classList.toggle('sidebar-mobile-show');
        };

        window.openModal = (id) => {
            document.getElementById(id).classList.remove('hidden');
            document.getElementById(id).classList.add('flex');
        };

        window.closeModal = (id) => {
            document.getElementById(id).classList.remove('flex');
            document.getElementById(id).classList.add('hidden');
        };

        function showToast(message, type = 'success') {
            const toastArea = document.getElementById('toast-area');
            const toast = document.createElement('div');
            toast.className = `content-glass px-6 py-3 rounded-xl text-[9px] font-black uppercase tracking-widest shadow-3xl animate-slide-in toast-${type}`;
            
            let icon = 'fa-circle-check';
            if(type === 'error') icon = 'fa-circle-exclamation';
            if(type === 'warning') icon = 'fa-triangle-exclamation';
            if(type === 'info') icon = 'fa-circle-info';
            
            toast.innerHTML = `<i class="fa-solid ${icon} mr-2"></i> ${message}`;
            toastArea.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(20px)';
                setTimeout(() => toast.remove(), 300);
            }, 4000);
        }

        let alertCb = null;
        window.confirmAction = (message, callback) => {
            document.getElementById('alert-msg').innerText = message;
            alertCb = callback;
            document.getElementById('custom-alert').style.display = 'flex';
        };
        
        document.getElementById('alert-confirm-btn').onclick = () => {
            if(alertCb) {
                alertCb();
                closeAlert();
            }
        };
        
        window.closeAlert = () => {
            document.getElementById('custom-alert').style.display = 'none';
        };

        setInterval(() => {
            const now = new Date();
            document.getElementById('live-date').innerText = now.toLocaleDateString();
            document.getElementById('live-clock').innerText = now.toLocaleTimeString();
        }, 1000);

        // Initialize
        window.addEventListener('DOMContentLoaded', () => {
            const clock = document.getElementById('live-clock');
            const date = document.getElementById('live-date');
            if(clock && date) {
                const now = new Date();
                date.innerText = now.toLocaleDateString();
                clock.innerText = now.toLocaleTimeString();
            }
            
            // Auto-switch to login tab on load
            switchAuthTab('login');
            
            // Initialize character count
            updateCharCount();
        });
    </script>
</body>
</html>
